/*
  OpenTok JavaScript Library v2.0.12
 http://www.tokbox.com/

 Copyright (c) 2011 TokBox, Inc.

 Date: July 30 09:29:10 2013
*/
(function(e){e.OT||(e.OT={});OT.properties={version:"v2.0.12",build:"bc4660b",debug:"false",websiteURL:"http://www.tokbox.com",cdnURL:"http://static.opentok.com",loggingURL:"http://hlg.tokbox.com/prod",apiURL:"http://anvil.opentok.com",supportSSL:"true",cdnURLSSL:"https://swww.tokbox.com",loggingURLSSL:"https://hlg.tokbox.com/prod",apiURLSSL:"https://anvil.opentok.com"}})(window);
(function(){var e=this,c=e._,b={},a=Array.prototype,d=Object.prototype,f=a.push,h=a.slice,i=a.concat,j=d.toString,k=d.hasOwnProperty,m=a.forEach,n=a.map,o=a.reduce,t=a.reduceRight,s=a.filter,p=a.every,v=a.some,q=a.indexOf,u=a.lastIndexOf,d=Array.isArray,y=Object.keys,z=Function.prototype.bind,g=function(a){if(a instanceof g)return a;if(!(this instanceof g))return new g(a);this._wrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=g),exports._=
g):e._=g;g.VERSION="1.4.4";var r=g.each=g.forEach=function(a,d,c){if(a!=null)if(m&&a.forEach===m)a.forEach(d,c);else if(a.length===+a.length)for(var f=0,h=a.length;f<h;f++){if(d.call(c,a[f],f,a)===b)break}else for(f in a)if(g.has(a,f)&&d.call(c,a[f],f,a)===b)break};g.map=g.collect=function(a,b,d){var c=[];if(a==null)return c;if(n&&a.map===n)return a.map(b,d);r(a,function(a,C,f){c[c.length]=b.call(d,a,C,f)});return c};g.reduce=g.foldl=g.inject=function(a,b,d,c){var f=arguments.length>2;a==null&&(a=
[]);if(o&&a.reduce===o){c&&(b=g.bind(b,c));return f?a.reduce(b,d):a.reduce(b)}r(a,function(a,C,h){if(f)d=b.call(c,d,a,C,h);else{d=a;f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};g.reduceRight=g.foldr=function(a,b,d,c){var f=arguments.length>2;a==null&&(a=[]);if(t&&a.reduceRight===t){c&&(b=g.bind(b,c));return f?a.reduceRight(b,d):a.reduceRight(b)}var h=a.length;if(h!==+h)var e=g.keys(a),h=e.length;r(a,function(k,g,j){g=e?e[--h]:--h;if(f)d=b.call(c,d,a[g],
g,j);else{d=a[g];f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};g.find=g.detect=function(a,b,d){var c;A(a,function(a,f,C){if(b.call(d,a,f,C)){c=a;return true}});return c};g.filter=g.select=function(a,b,d){var c=[];if(a==null)return c;if(s&&a.filter===s)return a.filter(b,d);r(a,function(a,f,C){b.call(d,a,f,C)&&(c[c.length]=a)});return c};g.reject=function(a,b,d){return g.filter(a,function(a,c,f){return!b.call(d,a,c,f)},d)};g.every=g.all=function(a,d,c){d||
(d=g.identity);var f=true;if(a==null)return f;if(p&&a.every===p)return a.every(d,c);r(a,function(a,C,h){if(!(f=f&&d.call(c,a,C,h)))return b});return!!f};var A=g.some=g.any=function(a,d,c){d||(d=g.identity);var f=false;if(a==null)return f;if(v&&a.some===v)return a.some(d,c);r(a,function(a,h,C){if(f||(f=d.call(c,a,h,C)))return b});return!!f};g.contains=g.include=function(a,b){return a==null?false:q&&a.indexOf===q?a.indexOf(b)!=-1:A(a,function(a){return a===b})};g.invoke=function(a,b){var d=h.call(arguments,
2),c=g.isFunction(b);return g.map(a,function(a){return(c?b:a[b]).apply(a,d)})};g.pluck=function(a,b){return g.map(a,function(a){return a[b]})};g.where=function(a,b,d){return g.isEmpty(b)?d?null:[]:g[d?"find":"filter"](a,function(a){for(var d in b)if(b[d]!==a[d])return false;return true})};g.findWhere=function(a,b){return g.where(a,b,true)};g.max=function(a,b,d){if(!b&&g.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&g.isEmpty(a))return-Infinity;var c={computed:-Infinity,
value:-Infinity};r(a,function(a,f,h){f=b?b.call(d,a,f,h):a;f>=c.computed&&(c={value:a,computed:f})});return c.value};g.min=function(a,b,d){if(!b&&g.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&g.isEmpty(a))return Infinity;var c={computed:Infinity,value:Infinity};r(a,function(a,f,h){f=b?b.call(d,a,f,h):a;f<c.computed&&(c={value:a,computed:f})});return c.value};g.shuffle=function(a){var b,d=0,c=[];r(a,function(a){b=g.random(d++);c[d-1]=c[b];c[b]=a});return c};var B=
function(a){return g.isFunction(a)?a:function(b){return b[a]}};g.sortBy=function(a,b,d){var c=B(b);return g.pluck(g.map(a,function(a,b,f){return{value:a,index:b,criteria:c.call(d,a,b,f)}}).sort(function(a,b){var d=a.criteria,c=b.criteria;if(d!==c){if(d>c||d===void 0)return 1;if(d<c||c===void 0)return-1}return a.index<b.index?-1:1}),"value")};var x=function(a,b,d,c){var f={},h=B(b||g.identity);r(a,function(b,e){var k=h.call(d,b,e,a);c(f,k,b)});return f};g.groupBy=function(a,b,d){return x(a,b,d,function(a,
b,d){(g.has(a,b)?a[b]:a[b]=[]).push(d)})};g.countBy=function(a,b,d){return x(a,b,d,function(a,b){g.has(a,b)||(a[b]=0);a[b]++})};g.sortedIndex=function(a,b,d,c){for(var d=d==null?g.identity:B(d),b=d.call(c,b),f=0,h=a.length;f<h;){var e=f+h>>>1;d.call(c,a[e])<b?f=e+1:h=e}return f};g.toArray=function(a){return!a?[]:g.isArray(a)?h.call(a):a.length===+a.length?g.map(a,g.identity):g.values(a)};g.size=function(a){return a==null?0:a.length===+a.length?a.length:g.keys(a).length};g.first=g.head=g.take=function(a,
b,d){return a==null?void 0:b!=null&&!d?h.call(a,0,b):a[0]};g.initial=function(a,b,d){return h.call(a,0,a.length-(b==null||d?1:b))};g.last=function(a,b,d){return a==null?void 0:b!=null&&!d?h.call(a,Math.max(a.length-b,0)):a[a.length-1]};g.rest=g.tail=g.drop=function(a,b,d){return h.call(a,b==null||d?1:b)};g.compact=function(a){return g.filter(a,g.identity)};var w=function(a,b,d){r(a,function(a){g.isArray(a)?b?f.apply(d,a):w(a,b,d):d.push(a)});return d};g.flatten=function(a,b){return w(a,b,[])};g.without=
function(a){return g.difference(a,h.call(arguments,1))};g.uniq=g.unique=function(a,b,d,c){if(g.isFunction(b)){c=d;d=b;b=false}var d=d?g.map(a,d,c):a,f=[],h=[];r(d,function(d,c){if(b?!c||h[h.length-1]!==d:!g.contains(h,d)){h.push(d);f.push(a[c])}});return f};g.union=function(){return g.uniq(i.apply(a,arguments))};g.intersection=function(a){var b=h.call(arguments,1);return g.filter(g.uniq(a),function(a){return g.every(b,function(b){return g.indexOf(b,a)>=0})})};g.difference=function(b){var d=i.apply(a,
h.call(arguments,1));return g.filter(b,function(a){return!g.contains(d,a)})};g.zip=function(){for(var a=h.call(arguments),b=g.max(g.pluck(a,"length")),d=Array(b),c=0;c<b;c++)d[c]=g.pluck(a,""+c);return d};g.object=function(a,b){if(a==null)return{};for(var d={},c=0,f=a.length;c<f;c++)b?d[a[c]]=b[c]:d[a[c][0]]=a[c][1];return d};g.indexOf=function(a,b,d){if(a==null)return-1;var c=0,f=a.length;if(d)if(typeof d=="number")c=d<0?Math.max(0,f+d):d;else{c=g.sortedIndex(a,b);return a[c]===b?c:-1}if(q&&a.indexOf===
q)return a.indexOf(b,d);for(;c<f;c++)if(a[c]===b)return c;return-1};g.lastIndexOf=function(a,b,d){if(a==null)return-1;var c=d!=null;if(u&&a.lastIndexOf===u)return c?a.lastIndexOf(b,d):a.lastIndexOf(b);for(d=c?d:a.length;d--;)if(a[d]===b)return d;return-1};g.range=function(a,b,d){if(arguments.length<=1){b=a||0;a=0}for(var d=arguments[2]||1,c=Math.max(Math.ceil((b-a)/d),0),f=0,h=Array(c);f<c;){h[f++]=a;a=a+d}return h};g.bind=function(a,b){if(a.bind===z&&z)return z.apply(a,h.call(arguments,1));var d=
h.call(arguments,2);return function(){return a.apply(b,d.concat(h.call(arguments)))}};g.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}};g.bindAll=function(a){var b=h.call(arguments,1);b.length===0&&(b=g.functions(a));r(b,function(b){a[b]=g.bind(a[b],a)});return a};g.memoize=function(a,b){var d={};b||(b=g.identity);return function(){var c=b.apply(this,arguments);return g.has(d,c)?d[c]:d[c]=a.apply(this,arguments)}};g.delay=function(a,
b){var d=h.call(arguments,2);return setTimeout(function(){return a.apply(null,d)},b)};g.defer=function(a){return g.delay.apply(g,[a,1].concat(h.call(arguments,1)))};g.throttle=function(a,b){var d,c,f,h,e=0,k=function(){e=new Date;f=null;h=a.apply(d,c)};return function(){var g=new Date,j=b-(g-e);d=this;c=arguments;if(j<=0){clearTimeout(f);f=null;e=g;h=a.apply(d,c)}else f||(f=setTimeout(k,j));return h}};g.debounce=function(a,b,d){var c,f;return function(){var h=this,e=arguments,k=d&&!c;clearTimeout(c);
c=setTimeout(function(){c=null;d||(f=a.apply(h,e))},b);k&&(f=a.apply(h,e));return f}};g.once=function(a){var b=false,d;return function(){if(b)return d;b=true;d=a.apply(this,arguments);a=null;return d}};g.wrap=function(a,b){return function(){var d=[a];f.apply(d,arguments);return b.apply(this,d)}};g.compose=function(){var a=arguments;return function(){for(var b=arguments,d=a.length-1;d>=0;d--)b=[a[d].apply(this,b)];return b[0]}};g.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,
arguments)}};g.keys=y||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],d;for(d in a)g.has(a,d)&&(b[b.length]=d);return b};g.values=function(a){var b=[],d;for(d in a)g.has(a,d)&&b.push(a[d]);return b};g.pairs=function(a){var b=[],d;for(d in a)g.has(a,d)&&b.push([d,a[d]]);return b};g.invert=function(a){var b={},d;for(d in a)g.has(a,d)&&(b[a[d]]=d);return b};g.functions=g.methods=function(a){var b=[],d;for(d in a)g.isFunction(a[d])&&b.push(d);return b.sort()};g.extend=function(a){r(h.call(arguments,
1),function(b){if(b)for(var d in b)a[d]=b[d]});return a};g.pick=function(b){var d={},c=i.apply(a,h.call(arguments,1));r(c,function(a){a in b&&(d[a]=b[a])});return d};g.omit=function(b){var d={},c=i.apply(a,h.call(arguments,1)),f;for(f in b)g.contains(c,f)||(d[f]=b[f]);return d};g.defaults=function(a){r(h.call(arguments,1),function(b){if(b)for(var d in b)a[d]==null&&(a[d]=b[d])});return a};g.clone=function(a){return!g.isObject(a)?a:g.isArray(a)?a.slice():g.extend({},a)};g.tap=function(a,b){b(a);return a};
var E=function(a,b,d,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof g)a=a._wrapped;if(b instanceof g)b=b._wrapped;var f=j.call(a);if(f!=j.call(b))return false;switch(f){case "[object String]":return a==""+b;case "[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||
typeof b!="object")return false;for(var h=d.length;h--;)if(d[h]==a)return c[h]==b;d.push(a);c.push(b);var h=0,e=true;if(f=="[object Array]"){h=a.length;if(e=h==b.length)for(;h--;)if(!(e=E(a[h],b[h],d,c)))break}else{var f=a.constructor,k=b.constructor;if(f!==k&&(!g.isFunction(f)||!(f instanceof f&&g.isFunction(k)&&k instanceof k)))return false;for(var i in a)if(g.has(a,i)){h++;if(!(e=g.has(b,i)&&E(a[i],b[i],d,c)))break}if(e){for(i in b)if(g.has(b,i)&&!h--)break;e=!h}}d.pop();c.pop();return e};g.isEqual=
function(a,b){return E(a,b,[],[])};g.isEmpty=function(a){if(a==null)return true;if(g.isArray(a)||g.isString(a))return a.length===0;for(var b in a)if(g.has(a,b))return false;return true};g.isElement=function(a){return!!(a&&a.nodeType===1)};g.isArray=d||function(a){return j.call(a)=="[object Array]"};g.isObject=function(a){return a===Object(a)};r("Arguments Function String Number Date RegExp".split(" "),function(a){g["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}});g.isArguments(arguments)||
(g.isArguments=function(a){return!(!a||!g.has(a,"callee"))});"function"!==typeof/./&&(g.isFunction=function(a){return typeof a==="function"});g.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};g.isNaN=function(a){return g.isNumber(a)&&a!=+a};g.isBoolean=function(a){return a===true||a===false||j.call(a)=="[object Boolean]"};g.isNull=function(a){return a===null};g.isUndefined=function(a){return a===void 0};g.has=function(a,b){return k.call(a,b)};g.noConflict=function(){e._=c;return this};
g.identity=function(a){return a};g.times=function(a,b,d){for(var c=Array(a),f=0;f<a;f++)c[f]=b.call(d,f);return c};g.random=function(a,b){if(b==null){b=a;a=0}return a+Math.floor(Math.random()*(b-a+1))};var D={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};D.unescape=g.invert(D.escape);var H={escape:RegExp("["+g.keys(D.escape).join("")+"]","g"),unescape:RegExp("("+g.keys(D.unescape).join("|")+")","g")};g.each(["escape","unescape"],function(a){g[a]=function(b){return b==
null?"":(""+b).replace(H[a],function(b){return D[a][b]})}});g.result=function(a,b){if(a==null)return null;var d=a[b];return g.isFunction(d)?d.call(a):d};g.mixin=function(a){r(g.functions(a),function(b){var d=g[b]=a[b];g.prototype[b]=function(){var a=[this._wrapped];f.apply(a,arguments);a=d.apply(g,a);return this._chain?g(a).chain():a}})};var I=0;g.uniqueId=function(a){var b=++I+"";return a?a+b:b};g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};
var F=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},G=/\\|'|\r|\n|\t|\u2028|\u2029/g;g.template=function(a,b,d){var c,d=g.defaults({},d,g.templateSettings),f=RegExp([(d.escape||F).source,(d.interpolate||F).source,(d.evaluate||F).source].join("|")+"|$","g"),h=0,e="__p+='";a.replace(f,function(b,d,c,f,k){e=e+a.slice(h,k).replace(G,function(a){return"\\"+J[a]});d&&(e=e+("'+\n((__t=("+d+"))==null?'':_.escape(__t))+\n'"));c&&(e=e+("'+\n((__t=("+c+"))==null?'':__t)+\n'"));
f&&(e=e+("';\n"+f+"\n__p+='"));h=k+b.length;return b});e=e+"';\n";d.variable||(e="with(obj||{}){\n"+e+"}\n");e="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";try{c=new Function(d.variable||"obj","_",e)}catch(k){k.source=e;throw k;}if(b)return c(b,g);b=function(a){return c.call(this,a,g)};b.source="function("+(d.variable||"obj")+"){\n"+e+"}";return b};g.chain=function(a){return g(a).chain()};g.mixin(g);r("pop push reverse shift sort splice unshift".split(" "),
function(b){var d=a[b];g.prototype[b]=function(){var a=this._wrapped;d.apply(a,arguments);(b=="shift"||b=="splice")&&a.length===0&&delete a[0];return this._chain?g(a).chain():a}});r(["concat","join","slice"],function(b){var d=a[b];g.prototype[b]=function(){var a=d.apply(this._wrapped,arguments);return this._chain?g(a).chain():a}});g.extend(g.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);
(function(){function e(a,b){var d=b||0,c=k;return c[a[d++]]+c[a[d++]]+c[a[d++]]+c[a[d++]]+"-"+c[a[d++]]+c[a[d++]]+"-"+c[a[d++]]+c[a[d++]]+"-"+c[a[d++]]+c[a[d++]]+"-"+c[a[d++]]+c[a[d++]]+c[a[d++]]+c[a[d++]]+c[a[d++]]+c[a[d++]]}function c(a,b,d){d=b&&d||0;"string"==typeof a&&(b="binary"==a?new j(16):null,a=null);a=a||{};a=a.random||(a.rng||i)();a[6]=a[6]&15|64;a[8]=a[8]&63|128;if(b)for(var c=0;16>c;c++)b[d+c]=a[c];return b||e(a)}var b=this,a,d,f=Array(16);a=function(){for(var a,b=0,b=0;16>b;b++)0===
(b&3)&&(a=4294967296*Math.random()),f[b]=a>>>((b&3)<<3)&255;return f};if(b.crypto&&crypto.getRandomValues){var h=new Uint32Array(4);d=function(){crypto.getRandomValues(h);for(var a=0;16>a;a++)f[a]=h[a>>2]>>>8*(a&3)&255;return f}}for(var i=d||a,j="function"==typeof Buffer?Buffer:Array,k=[],m={},n=0;256>n;n++)k[n]=(n+256).toString(16).substr(1),m[k[n]]=n;c.v4=c;c.parse=function(a,b,d){var c=b&&d||0,f=0,b=b||[];for(a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>f&&(b[c+f++]=m[a])});16>f;)b[c+
f++]=0;return b};c.unparse=e;c.BufferClass=j;c.mathRNG=a;c.whatwgRNG=d;var o=b.uuid;c.noConflict=function(){b.uuid=o;return c};b.uuid=c})();
!function(e){e.OT||(e.OT={});OT._=_.noConflict();OT.$=function(b){return document.getElementById(b)};OT.$.noop=function(){};OT._.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};OT.$.supportsWebSockets=function(){return"WebSocket"in e};OT.$.now=function(){var b=e.performance||{},a,d=b.now||b.mozNow||b.msNow||b.oNow||b.webkitNow;if(d){d=d.bind(b);a=b.timing.navigationStart;return function(){return a+d()}}return function(){return(new Date).getTime()}}();
OT.$.browser=function(){var b=e.navigator.userAgent.toLowerCase(),a,d="Unknown";b.indexOf("firefox")>-1&&(d="Firefox");b.indexOf("opera")>-1?d="Opera":b.indexOf("msie")>-1?d="IE":b.indexOf("chrome")>-1&&(d="Chrome");if((a=e.navigator.vendor)&&a.toLowerCase().indexOf("apple")>-1)d="Safari";b=null;OT.$.browser=function(){return d};return d};OT.$.deepClone=function(b){if(!OT._.isObject(b))return b;var a=OT._.isArray(b)?[]:{},d;for(d in b)b.hasOwnProperty(d)&&(a[d]=OT._.isObject(b[d])?this.deepClone(b[d]):
b[d]);return a};OT.$.JSONify=e.JSON&&e.JSON.stringify?e.JSON.stringify:function(b){var a="{ ",d;for(d in b)a=typeof b[d]=="boolean"?a+('"'+d+'":'+b[d]+", "):a+('"'+d+'":"'+b[d].toString()+'", ');return a=a.length>1?a.substring(0,a.length-2)+" }":"{}"};OT.$.canDefineProperty=!0;try{Object.defineProperty({},"x",{})}catch(c){OT.$.canDefineProperty=!1}Object.create||(Object.create=function(b){function a(){}if(arguments.length>1)throw Error("Object.create implementation only accepts the first parameter.");
a.prototype=b;return new a})}(window);
(function(e){e.OT||(e.OT={});if(!OT.properties)throw Error("OT.properties does not exist, please ensure that you include a valid properties file.");var c=OT,b=OT.properties,a=OT._.clone(b);a.debug="true"===b.debug||!0===b.debug;a.supportSSL="true"===b.supportSSL||!0===b.supportSSL;a.supportSSL&&(0<=e.location.protocol.indexOf("https")||0<=e.location.protocol.indexOf("chrome-extension"))?(a.assetURL=a.cdnURLSSL+"/webrtc/"+a.version,a.loggingURL=a.loggingURLSSL,a.apiURL=a.apiURLSSL):a.assetURL=a.cdnURL+
"/webrtc/"+a.version;a.configURL=a.assetURL+"/js/dynamic_config.min.js";a.cssURL=a.assetURL+"/css/ot.min.css";c.properties=a})(window);
(function(e){var c=[];e.addEventListener("message",function(b){b.source==e&&"OT.$.zero-timeout"==b.data&&(b.stopPropagation(),0<c.length&&c.shift()())},!0);OT.$.callAsync=function(b){c.push(b);e.postMessage("OT.$.zero-timeout","*")};OT.$.createAsyncHandler=function(b){return function(){var a=Array.prototype.slice.call(arguments);OT.$.callAsync(function(){b.apply(null,a)})}}})(window);
(function(){OT.$.eventing=function(e){function c(a,b,d,c){if(a&&0!==a.length){var f=a.length;OT._.forEach(a,function(a){OT.$.callAsync(function(){try{a.handler.apply(a.context||null,b)}finally{f--,0===f&&c&&c.apply(null,b.slice())}})})}}var b={},a=function(a,d){b[a]&&(d?b[a]=OT._.reject(b[a],function(a){return a.context===d}):delete b[a])},d=function(a,d,c){var f={handler:d};c&&(f.context=c);a.forEach(function(a){b[a]||(b[a]=[]);b[a].push(f)})}.bind(e),f=function(a,d,c){function f(a){return a.handler===
d&&a.context===c}a.forEach(function(a){b[a]&&(b[a]=OT._.reject(b[a],f))})}.bind(e);e.dispatchEvent=function(a,d){if(!a.type)throw OT.error("OT.Eventing.dispatchEvent: Event has no type"),OT.error(a),Error("OT.Eventing.dispatchEvent: Event has no type");a.target||(a.target=this);if(!b[a.type]||0===b[a.type].length){var f=[a];d&&d.apply(null,f.slice())}else return c(b[a.type],[a],a.type,d),this};e.trigger=function(a){if(b[a]&&0!==b[a].length){var d=Array.prototype.slice.call(arguments);d.shift();c(b[a],
d,a);return this}};e.on=function(a,b,c){if("string"===typeof a&&b)d(a.split(" "),b,c);else for(var f in a)a.hasOwnProperty(f)&&d([f],a[f],b);return this};e.off=function(d,c,e){if("string"===typeof d)c&&OT._.isFunction(c)?f(d.split(" "),c,e):d.split(" ").forEach(function(b){a(b,c)},this);else if(d)for(var k in d)d.hasOwnProperty(k)&&f([k],d[k],c);else b={};return this};e.one=function(a,b,c){var e=a.split(" "),m=function(){var a=b.apply(this,arguments);f(e,m,c);return a}.bind(this);d(e,m,c)};e.addEventListener=
function(a,b,c){d([a],b,c)};e.removeEventListener=function(a,b,d){f([a],b,d)};return e};OT.$.eventing(OT)})(window);
(function(){OT.Config=function(){var e=!1,c={},b={},a,d=document.head||document.getElementsByTagName("head")[0],f,h=function(){f&&(clearTimeout(f),f=null);a&&(a.onload=a.onreadystatechange=null,d&&a.parentNode&&d.removeChild(a),a=void 0)},i=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))f&&(clearTimeout(f),f=null),e||j._onLoadTimeout()},j={loadTimeout:4E3,load:function(b){if(!b)throw Error("You must pass a valid configUrl to Config.load");e=!1;setTimeout(function(){a=document.createElement("script");
a.async="async";a.src=b;a.onload=a.onreadystatechange=OT._.bind(i,this);d.appendChild(a)},1);f=setTimeout(function(){j._onLoadTimeout()},this.loadTimeout)},_onLoadTimeout:function(){h();OT.warn("TB DynamicConfig failed to load in "+j.loadTimeout+" ms");this.trigger("dynamicConfigLoadFailed")},isLoaded:function(){return e},reset:function(){h();e=!1;c={};b={}},replaceWith:function(a){h();a||(a={});c=a.global||{};b=a.partners||{};e||(e=!0);this.trigger("dynamicConfigChanged")},get:function(a,d,f){a=
f&&b[f]&&b[f][a]?b[f][a]:c[a];return a?a[d]:null}};OT.$.eventing(j);return j}()})(window);
(function(e){function c(c,f,j){return function(){if(a>=f){var k=e.console;if(k&&k[c])if(k[c].apply||Function.prototype.bind)k[c].apply||(k[c]=Function.prototype.bind.call(k[c],k)),k[c].apply(k,arguments);else k[c](Array.prototype.slice.apply(arguments).join(" "));else j&&j.apply(OT,arguments);if(k=arguments){var m;try{m=OT.$.JSONify(k)}catch(n){m=k.toString()}2>=m.length||d.push([c,b(),m])}}}}function b(){var a=new Date;return a.toLocaleTimeString()+a.getMilliseconds()}OT.DEBUG=5;OT.LOG=4;OT.INFO=
3;OT.WARN=2;OT.ERROR=1;OT.NONE=0;var a=OT.NONE,d=[],f=!1;OT.log=c("log",OT.LOG);OT.debug=c("debug",OT.DEBUG,OT.log);OT.info=c("info",OT.INFO,OT.log);OT.warn=c("warn",OT.WARN,OT.log);OT.error=c("error",OT.ERROR,OT.log);OT.setLogLevel=function(b){a="number"===typeof b?b:0;a>=OT.DEBUG&&!f&&(OT.debug("OpenTok JavaScript library "+OT.properties.version),OT.debug("Release notes: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html"),OT.debug("Known issues: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html#knownIssues"),
f=!0);OT.debug("TB.setLogLevel("+a+")");return a};OT.getLogs=function(){return d};OT.setLogLevel(OT.properties.debug?OT.DEBUG:OT.ERROR)})(window);(function(){OT.$.castToBoolean=function(e,c){return void 0===e?c:"true"===e||!0===e};OT.$.roundFloat=function(e,c){return parseInt(Math.round(e*Math.pow(10,c)),10)/Math.pow(10,c)}})(window);
(function(){function e(c){for(var b in c)if(c.hasOwnProperty(b))return!0;return!1}OT.$.supportsClassList=function(){var c=typeof("undefined"!==document)&&"classList"in document.createElement("a");OT.$.supportsClassList=function(){return c};return c};OT.$.removeElement=function(c){c&&c.parentNode&&c.parentNode.removeChild(c)};OT.$.removeElementById=function(c){this.removeElement(OT.$(c))};OT.$.removeElementsByType=function(c,b){if(c)for(var a=c.getElementsByTagName(b);a.length;)c.removeChild(a[0])};
OT.$.emptyElement=function(c){for(;c.firstChild;)c.removeChild(c.firstChild);return c};OT.$.createElement=function(c,b,a){c=document.createElement(c);if(b)for(var d in b)if("object"===typeof b[d]){c[d]||(c[d]={});var f=b[d],e;for(e in f)c[d][e]=f[e]}else"className"===d?c.className=b[d]:c.setAttribute(d,b[d]);a&&(c.innerHTML=a);return c};OT.$.createButton=function(c,b,a){c=OT.$.createElement("button",b,c);if(a){for(var d in a)if(a.hasOwnProperty(d))OT.$.on(c,d,a[d]);c._boundEvents=a}return c};OT.$.on=
function(c,b,a){if(c.addEventListener)c.addEventListener(b,a,!1);else if(c.attachEvent)c.attachEvent("on"+b,a);else{var d=c["on"+b];c["on"+b]=function(){a.apply(this,arguments);d&&d.apply(this,arguments)}}};OT.$.off=function(c,b,a){c.removeEventListener?c.removeEventListener(b,a,!1):c.detachEvent&&c.detachEvent("on"+b,a)};OT.$.isDisplayNone=function(c){return(0==c.offsetWidth||0===c.offsetHeight)&&"none"===OT.$.css(c,"display")?!0:c.parentNode&&c.parentNode.style?OT.$.isDisplayNone(c.parentNode):
!1};OT.$.findElementWithDisplayNone=function(c){return(0==c.offsetWidth||0===c.offsetHeight)&&"none"===OT.$.css(c,"display")?c:c.parentNode&&c.parentNode.style?OT.$.findElementWithDisplayNone(c.parentNode):null};OT.$.observeStyleChanges=function(c,b,a){var d={},f=function(a){switch(a){case "width":return OT.$.width(c);case "height":return OT.$.height(c);default:return OT.$.css(c)}};b.forEach(function(a){d[a]=f(a)});observer=new MutationObserver(function(c){var i={};c.forEach(function(a){"style"===
a.attributeName&&b.forEach(function(a){var b=f(a);b!==d[a]&&(i[a]=[d[a],b],d[a]=b)})});e(i)&&OT.$.callAsync(function(){a.call(null,i)})});observer.observe(c,{attributes:!0,attributeFilter:["style"],childList:!1,characterData:!1,subtree:!1});return observer};OT.$.observeNodeOrChildNodeRemoval=function(c,b){observer=new MutationObserver(function(a){var d=[];a.forEach(function(a){a.removedNodes.length&&(d=d.concat(Array.prototype.slice.call(a.removedNodes)))});d.length&&OT.$.callAsync(function(){b(d)})});
observer.observe(c,{attributes:!1,childList:!0,characterData:!1,subtree:!0});return observer}})(window);
(function(){OT.$.addClass=function(b,a){if(1===b.nodeType){var d=a.trim().split(/\s+/),c;if(OT.$.supportsClassList()){c=0;for(l=d.length;c<l;++c)b.classList.add(d[c])}else{if(!b.className&&1===d.length)b.className=a;else{var e=" "+b.className+" ";c=0;for(l=d.length;c<l;++c)~e.indexOf(" "+d[c]+" ")||(e+=d[c]+" ");b.className=e.trim()}return this}}};OT.$.removeClass=function(b,a){if(a&&1===b.nodeType){var d=a.trim().split(/\s+/),c;if(OT.$.supportsClassList()){c=0;for(l=d.length;c<l;++c)b.classList.remove(d[c])}else{var e=
(" "+b.className+" ").replace(/[\s+]/," ");c=0;for(l=d.length;c<l;++c)e=e.replace(" "+d[c]+" "," ");b.className=e.trim();return this}}};var e=function(b){return 0<b.offsetWidth?b.offsetWidth+"px":OT.$.css(b,"width")},c=function(b){return 0<b.offsetHeight?b.offsetHeight+"px":OT.$.css(b,"height")};OT.$.width=function(b,a){return a?(OT.$.css(b,"width",a),this):OT.$.isDisplayNone(b)?OT.$.makeVisibleAndYield(b,function(){return e(b)}):e(b)};OT.$.height=function(b,a){return a?(OT.$.css(b,"height",a),this):
OT.$.isDisplayNone(b)?OT.$.makeVisibleAndYield(b,function(){return c(b)}):c(b)};OT.$.centerElement=function(b,a,d){a||(a=parseInt(OT.$.width(b),10));d||(d=parseInt(OT.$.height(b),10));OT.$.css(b,"margin",-0.5*d+"px 0 0 "+(-0.5*a+"px"));OT.$.addClass(b,"OT_centered")}})(window);
(function(){var e={},c={};OT.$.show=function(b){var a=b.style.display;b.ownerDocument.defaultView.getComputedStyle(b,null).getPropertyValue("display");if(""===a||"none"===a)b.style.display=e[b]||"",delete e[b];if("none"===b.ownerDocument.defaultView.getComputedStyle(b,null).getPropertyValue("display")){e[b]="none";a=b.style;if(c[b.ownerDocument]&&c[b.ownerDocument][b.nodeName])b=c[b.ownerDocument][b.nodeName];else{c[b.ownerDocument]||(c[b.ownerDocument]={});var d=b.ownerDocument.createElement(b.nodeName);
b.ownerDocument.body.appendChild(d);b=c[b.ownerDocument][b.nodeName]=OT.$.css(d,"display");OT.$.removeElement(d)}a.display=b}return this};OT.$.hide=function(b){if("none"!==b.style.display)return e[b]=b.style.display,b.style.display="none",this};OT.$.css=function(b,a,d){if("string"!==typeof a){var b=b.style,c;for(c in a)b[c]=a[c];return this}if(void 0!==d)return b.style[a]=d,this;a=a.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase();c=b.ownerDocument.defaultView.getComputedStyle(b,null).getPropertyValue(a);
""===c&&(c=b.style[a]);return c};OT.$.applyCSS=function(b,a,d){var c={},e;for(e in a)a.hasOwnProperty(e)&&(c[e]=b.style[e],OT.$.css(b,e,a[e]));d=d();for(e in a)a.hasOwnProperty(e)&&OT.$.css(b,e,c[e]||"");return d};OT.$.makeVisibleAndYield=function(b,a){var d=OT.$.findElementWithDisplayNone(b);if(d)return OT.$.applyCSS(d,{display:"block",visibility:"hidden"},a)}})(window);
(function(e){function c(b){Object.defineProperty(b.prototype,"firstElementChild",{get:function(){var a;for(a=this.firstChild;a&&1!=a.nodeType;)a=a.nextSibling;return a}});Object.defineProperty(b.prototype,"lastElementChild",{get:function(){var a;for(a=this.lastChild;a&&1!=a.nodeType;)a=a.previousSibling;return a}});Object.defineProperty(b.prototype,"nextElementSibling",{get:function(){for(var a=this;(a=a.nextSibling)&&1!=a.nodeType;);return a}});Object.defineProperty(b.prototype,"previousElementSibling",
{get:function(){for(var a=this;(a=a.previousSibling)&&1!=a.nodeType;);return a}})}OT.$.parseXML=function(b){var a;e.DOMParser?a=(new DOMParser).parseFromString(b,"text/xml"):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(b),c(a));b=a.documentElement;return!b||!b.nodeName||"parsererror"===b.nodeName?null:a}})(window);
(function(){function e(b){if("string"===typeof b)return b;var a=[],d;for(d in b)a.push(encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a.join("&").replace(/\+/g,"%20")}OT.$.getXML=function(b,a){var d=a&&a.success,c=OT._.extend(a.headers||{},{"Content-Type":"application/xml"});OT.$.get(b,OT._.extend(a||{},{success:function(b){var c=b.target.responseXML,f;c?(f=c.documentElement,f=!f||!f.nodeName||"parsererror"===f.nodeName?!1:!0):f=!1;f?d&&d(c,b,b.target):a&&a.error&&a.error(b,b.target)},
headers:c}))};OT.$.getJSON=function(b,a){var d=a&&a.success;OT.$.get(b,OT._.extend(a||{},{success:function(b){var c;try{c=JSON.parse(b.target.responseText)}catch(e){a&&a.error&&a.error(b,b.target);return}d&&d(c,b,b.target)},headers:{"Content-Type":"application/json"}}))};OT.$.get=function(b,a){var d=new XMLHttpRequest,f=a||{};c(d,f.success,f.error);f.process&&d.addEventListener("progress",f.progress,!1);f.cancelled&&d.addEventListener("abort",f.cancelled,!1);d.open("GET",b,!0);f.headers||(f.headers=
{});for(var e in f.headers)d.setRequestHeader(e,f.headers[e]);d.send()};OT.$.post=function(b,a){var d=new XMLHttpRequest,f=a||{};c(d,f.success,f.error);f.process&&d.addEventListener("progress",f.progress,!1);f.cancelled&&d.addEventListener("abort",f.cancelled,!1);d.open("POST",b,!0);f.headers||(f.headers={});for(var h in f.headers)d.setRequestHeader(h,f.headers[h]);d.send(e(f.data))};OT.$.postFormData=function(b,a,d){if(!a)throw Error("OT.$.postFormData must be passed a data options.");var c=new FormData,
e;for(e in a)c.append(e,a[e]);OT.$.post(b,OT._.extend(d||{},{data:c}))};OT.$.getJSONP=function(b,a){var d,c=document.head||document.getElementsByTagName("head")[0],e,i=b,j=OT._.extend(a||{},{callbackParameter:"callback"}),k=function(){if((!d.readyState||/loaded|complete/.test(d.readyState))&&e)clearTimeout(e),e=null};j.callbackName="jsonp_callback_"+ +new Date;this.jsonp_callbacks[j.callbackName]=function(a){e&&(clearTimeout(e),e=null);d&&(d.onload=d.onreadystatechange=null,OT.$.removeElement(d),
d=void 0);j.success&&j.success(a)};i+=(/\?/.test(i)?"&":"?")+j.callbackParameter+"="+j.callbackName;d=OT.$.createElement("script",{async:"async",src:i,onload:k,onreadystatechange:k});c.appendChild(d);e=setTimeout(function(){_this._onLoadTimeout()},3E4)};var c=function(b,a,d){b.addEventListener("load",function(b){var c=b.target.status;200<=c&&300>c||304===c?a&&a.apply(null,arguments):d&&d(b)},!1);d&&b.addEventListener("error",d,!1)}})(window);
(function(){function e(a,b,f){b=b?parseInt(b,10):parseInt(OT.$.width(a.parentNode),10);f=f?parseInt(f,10):parseInt(OT.$.height(a.parentNode),10);0===b||0===f||(f=(b+0)/f,b={width:"100%",height:"100%",marginLeft:0,marginTop:0},f>c?(f=100*(f/c),b.height=f+"%",b.marginTop="-"+(f-100)/2+"%"):f<c&&(f=100*(c/f),b.width=f+"%",b.marginLeft="-"+(f-100)/2+"%"),OT.$.css(a,b))}var c=4/3,b=function(a){var b;a&&a.nodeName?(b=a,(!b.getAttribute("id")||0===b.getAttribute("id").length)&&b.setAttribute("id","OT_"+
uuid()),a=b.getAttribute("id")):(b=OT.$(a),a=a||"OT_"+uuid());b?OT.$.emptyElement(b):(b=OT.$.createElement("div",{id:a}),b.style.backgroundColor="#000000",document.body.appendChild(b));return b};OT.WidgetView=function(a,d){var c=b(a),h=document.createElement("div"),i,j,k,m,n=!0;d&&(width=d.width,height=d.height,width&&"number"==typeof width&&(width+="px"),height&&"number"==typeof height&&(height+="px"),c.style.width=width?width:"264px",c.style.height=height?height:"198px",c.style.overflow="hidden",
(void 0===d.mirror||d.mirror)&&OT.$.addClass(c,"OT_mirrored"));d.classNames&&OT.$.addClass(c,d.classNames);OT.$.addClass(c,"OT_loading");OT.$.addClass(h,"OT_video-container");h.style.width=c.style.width;h.style.height=c.style.height;c.appendChild(h);e(h,c.offsetWidth,c.offsetHeight);m=document.createElement("div");OT.$.addClass(m,"OT_video-poster");h.appendChild(m);i=OT.$.observeStyleChanges(c,["width","height"],function(a){e(h,a.width?a.width[1]:c.offsetWidth,a.height?a.height[1]:c.offsetHeight)});
k=OT.$.observeNodeOrChildNodeRemoval(c,function(a){if(j){if(OT._.some(a,function(a){return a===h||a.nodeName==="VIDEO"})){j.destroy();j=null}if(h){OT.$.removeElement(h);h=null}}});this.destroy=function(){if(i){i.disconnect();i=null}if(k){k.disconnect();k=null}if(j){j.destroy();j=null}if(c){OT.$.removeElement(c);c=null}};Object.defineProperties(this,{showPoster:{get:function(){return!OT.$.isDisplayNone(m)},set:function(a){a?OT.$.show(m):OT.$.hide(m)}},poster:{get:function(){return OT.$.css(m,"backgroundImage")},
set:function(a){OT.$.css(m,"backgroundImage","url("+a+")")}},loading:{get:function(){return n},set:function(a){(n=a)?OT.$.addClass(c,"OT_loading"):OT.$.removeClass(c,"OT_loading")}},video:{get:function(){return j},set:function(a){j&&j.destroy();a.appendTo(h);j=a;e(h,c.offsetWidth,c.offsetHeight)}},domElement:{get:function(){return c}},domId:{get:function(){return c.getAttribute("id")}}});this.addError=function(a){c.innerHTML="<p>"+a+"<p>";OT.$.addClass(c,"OT_subscriber_error")}}})(window);
(function(e){var c=function(){if(navigator.getUserMedia)return navigator.getUserMedia.bind(navigator);if(navigator.mozGetUserMedia)return navigator.mozGetUserMedia.bind(navigator);if(navigator.webkitGetUserMedia)return navigator.webkitGetUserMedia.bind(navigator)}();if(navigator.webkitGetUserMedia){if(webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=
function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams}),!webkitRTCPeerConnection.prototype.getRemoteStreams)webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}else if(navigator.mozGetUserMedia&&(MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),!MediaStream.prototype.getAudioTracks))MediaStream.prototype.getAudioTracks=
function(){return[]};OT.$.supportsWebRTC=function(){var b=!1;if(navigator.webkitGetUserMedia)b="function"===typeof webkitRTCPeerConnection&&!!webkitRTCPeerConnection.prototype.addStream;else if(navigator.mozGetUserMedia){var a=e.navigator.userAgent.toLowerCase().match(/Firefox\/([0-9\.]+)/i);if(b="function"===typeof mozRTCPeerConnection&&null!==a&&20<parseFloat(a[1],10))try{new mozRTCPeerConnection,b=!0}catch(d){b=!1}}OT.$.supportsWebRTC=function(){return b};return b};OT.$.supportedCryptoScheme=function(){if(!OT.$.supportsWebRTC())return"NONE";
var b=e.navigator.userAgent.toLowerCase().match(/chrome\/([0-9\.]+)/i);return b&&25>parseFloat(b[1],10)?"SDES_SRTP":"DTLS_SRTP"};OT.$.getUserMedia=function(b,a,d,f,e){if(!b||OT._.all(b,function(a){return!1===a}))OT.error("Couldn't get UserMedia: All constraints were false"),d({code:"NO_CONSTRAINTS"});else{var i=null,j=function(){i=null;f&&f()},k=function(a){i?clearTimeout(i):e&&e();d.apply(null,arguments)};try{c(b,function(){i?clearTimeout(i):e&&e();a.apply(null,arguments)},k)}catch(m){OT.error("Couldn't get UserMedia: "+
m.toString()),k({})}-1===location.protocol.indexOf("https")?setTimeout(j,100):i=setTimeout(j,500)}}})(window);
(function(){OT.Modal=function(e,c){this.el=OT.$.createElement("section",{className:"OT_root OT_dialog OT_modal"},OT._.template("        <header>            <h1><%= title %></h1>        </header>        <div class='OT_dialog-body'>            <%= body %>        </div>    ",{title:e,body:c}));this.el.style.display="none";document.body.appendChild(this.el);OT.$.centerElement(this.el);OT.$.show(this.el);this.close=function(){OT.$.removeElement(this.el);this.el=null;return this}};OT.$.tbAlert=function(e,
c){var b=new OT.Modal(e,"<div>"+c+"</div>");OT.$.addClass(b.el,"OT_tbalert");var a=OT.$.createElement("input",{className:"OT_closeButton",type:"button",value:"close"});b.el.appendChild(a);a.onclick=function(){b&&b.close();b=null}}})(window);
(function(e){function c(a,b){var d=document.createElement("video");d.setAttribute("autoplay","");d.innerHTML=a;if(b){!0===b.muted&&(delete b.muted,d.muted="true");for(var c in b)d.setAttribute(c,b[c])}return d}function b(a,b,d,c){if(navigator.mozGetUserMedia||0<b.getVideoTracks().length&&b.getVideoTracks()[0].enabled){var k=setTimeout(OT._.bind(function(){0===a.currentTime?c("The video stream failed to connect. Please notify the site owner if this continues to happen."):(OT.warn("Never got the loadedmetadata event but currentTime > 0"),
d())},this),3E4);a.addEventListener("loadedmetadata",function(){clearTimeout(k);d()},!1)}else d();navigator.mozGetUserMedia?a.mozSrcObject=b:a.src=e.URL.createObjectURL(b);a.play()}OT.VideoOrientation={ROTATED_NORMAL:"OTVideoOrientationRotatedNormal",ROTATED_LEFT:"OTVideoOrientationRotatedLeft",ROTATED_RIGHT:"OTVideoOrientationRotatedRight",ROTATED_UPSIDE_DOWN:"OTVideoOrientationRotatedUpsideDown"};OT.VideoElement=function(a){var h,i,j,k=!1,a=OT._.defaults(a||{},{fallbackText:"Sorry, Web RTC is not available in your browser"});
OT.$.eventing(this);var m=OT._.bind(function(a){this.trigger("error",null,"There was an unexpected problem with the Video Stream: "+(d[parseInt(a.target.error.code,10)]||"An unknown error occurred."),this)},this),n=OT._.bind(function(){k=!0;this.trigger("streamBound",this)},this),o=OT._.bind(function(a){this.trigger("error",OT.ExceptionCodes.P2P_CONNECTION_FAILED,a,this)},this);i=c(a.fallbackText,a.attributes);i.addEventListener("error",m,!1);Object.defineProperties(this,{stream:{get:function(){return h}},
domElement:{get:function(){return i}},parentElement:{get:function(){return j}},isBoundToStream:{get:function(){return k}},poster:{get:function(){return i.getAttribute("poster")},set:function(a){i.setAttribute("poster",a)}}});this.appendTo=function(a){j=a;j.appendChild(i);return this};this.bindToStream=function(a){k=!1;h=a;b(i,h,n,o);return this};this.unbindStream=function(){if(!h)return this;i&&(navigator.mozGetUserMedia?i.mozSrcObject=null:e.URL.revokeObjectURL(i.src));h=null;return this};this.setAudioVolume=
function(a){i&&OT.$.roundFloat(i.volume=a/100,2)};this.getAudioVolume=function(){return i?parseInt(100*i.volume,10):50};this.destroy=function(){this.off();this.unbindStream();i&&(OT.$.removeElement(i),i=null);j=null}};OT.$.canDefineProperty&&Object.defineProperty(OT.VideoElement.prototype,"imgData",{get:function(){var a=OT.$.createElement("canvas",{width:this.domElement.videoWidth,height:this.domElement.videoHeight,style:{display:"none"}});document.body.appendChild(a);a.getContext("2d").drawImage(this.domElement,
0,0,a.width,a.height);var b=a.toDataURL("image/png");OT.$.removeElement(a);return b.replace("data:image/png;base64,","").trim()}});var a={OTVideoOrientationRotatedNormal:"rotate(0deg)",OTVideoOrientationRotatedLeft:"rotate(90deg)",OTVideoOrientationRotatedRight:"rotate(-90deg)",OTVideoOrientationRotatedUpsideDown:"rotate(180deg)"};OT.$.canDefineProperty&&Object.defineProperty(OT.VideoElement.prototype,"orientation",{set:function(b){b=a[b]||a.ROTATED_NORMAL;switch(OT.$.browser()){case "Chrome":case "Safari":this.domElement.style.webkitTransform=
b;break;case "IE":this.domElement.style.msTransform=b;break;default:this.domElement.style.transform=b}}});var d={};e.MediaError&&(d[e.MediaError.MEDIA_ERR_ABORTED]="The fetching process for the media resource was aborted by the user agent at the user's request.",d[e.MediaError.MEDIA_ERR_NETWORK]="A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.",d[e.MediaError.MEDIA_ERR_DECODE]="An error of some description occurred while decoding the media resource, after the resource was established to be usable.",
d[e.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="The media resource indicated by the src attribute was not suitable. ")})(window);
(function(e){var c=[],b=!1;OT.Analytics=function(){var a=OT.properties.loggingURL+"/logging/ClientEvent",d=OT.properties.loggingURL+"/logging/ClientQos",f={},h={payloadType:"payload_type",partnerId:"partner_id",streamId:"stream_id",sessionId:"session_id",connectionId:"connection_id",widgetType:"widget_type",widgetId:"widget_id",avgAudioBitrate:"avg_audio_bitrate",avgVideoBitrate:"avg_video_bitrate"},i=function(b,c,f,e){OT.$.post(c?d:a,{success:f,error:e,data:b,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},
j=function(){if(!b&&0<c.length){b=!0;var a=c[0],d=function(){c.shift();b=!1;j()};a&&i(a.data,a.isQos,function(){a.onComplete();setTimeout(d,50)},function(){OT.debug("Failed to send ClientEvent, moving on to the next item.");setTimeout(d,50)})}};this.logError=function(a,b,d,c,e){e||(e={});d=e.partnerId;if(!0===OT.Config.get("exceptionLogging","enabled",d)){var h;d?(h=[d,b,a].join("_"),h=100>=(f[h]||0)):h=!1;if(!h){var d=[d,b,a].join("_"),j=this.escapePayload(OT._.extend(c||{},{message:j,userAgent:navigator.userAgent}));
f[d]="undefined"!==typeof f[d]?f[d]+1:1;return this.logEvent(OT._.extend(e,{action:b+"."+a,payloadType:j[0],payload:j[1]}))}}};this.logEvent=function(a){var b=a.partnerId;a||(a={});var a=OT._.extend({variation:"",guid:a.connectionId||"",widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:b,source:e.location.href,section:"",build:""},a),d;for(d in h)h.hasOwnProperty(d)&&a[d]&&(a[h[d]]=a[d],delete a[d]);c.push({data:a,onComplete:function(){},isQos:!1});j()};this.logQOS=function(a){var b=
a.partnerId;a||(a={});var a=OT._.extend({guid:a.connectionId,widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:b,source:e.location.href,build:"",duration:0},a),d;for(d in h)h.hasOwnProperty(d)&&a[d]&&(a[h[d]]=a[d],delete a[d]);c.push({data:a,onComplete:function(){},isQos:!0});j()};this.escapePayload=function(a){var b=[],d=[],c;for(c in a)a.hasOwnProperty(c)&&(null!==a[c]&&void 0!==a[c])&&(b.push(a[c]?a[c].toString().replace("|","\\|"):""),d.push(c.toString().replace("|","\\|")));
return[d.join("|"),b.join("|")]}}})(window);
(function(e){"file:"===location.protocol&&alert("You cannot test a page using WebRTC through the file system due to browser permissions. You must run it over a web server.");e.OT||(e.OT={});!e.URL&&e.webkitURL&&(e.URL=e.webkitURL);var c,b=document.location.hash;OT.initSession=function(a){this.sessions[a]||(this.sessions[a]=new OT.Session(a));return this.sessions[a]};OT.initPublisher=function(a,b,c){OT.debug("TB.initPublisher("+b+")");a=new OT.Publisher;a.publish(b,c);return a};OT.checkSystemRequirements=
function(){OT.debug("TB.checkSystemRequirements()");var a=OT.$.supportsWebSockets()&&OT.$.supportsWebRTC()?this.HAS_REQUIREMENTS:this.NOT_HAS_REQUIREMENTS;OT.checkSystemRequirements=function(){OT.debug("TB.checkSystemRequirements()");return a};return a};OT.upgradeSystemRequirements=function(){OT.onLoad(function(){for(var a=false,d=document.getElementsByTagName("meta"),e=0;e<d.length;e++){var h=d[e].httpEquiv,i=d[e].content;if(h&&h.toLowerCase()==="x-ua-compatible"&&i&&i.toLowerCase().indexOf("chrome=1")>
-1){a=true;break}}document.body.appendChild(function(){var b=document.createElement("iframe");b.id="_upgradeFlash";b.style.position="absolute";b.style.position="fixed";b.style.height="100%";b.style.width="100%";b.style.top="0px";b.style.left="0px";b.style.right="0px";b.style.bottom="0px";b.style.zIndex=1E3;try{b.style.backgroundColor="rgba(0,0,0,0.2)"}catch(d){b.style.backgroundColor="transparent";b.setAttribute("allowTransparency","true")}b.setAttribute("frameBorder","0");b.frameBorder="0";b.scrolling=
"no";b.setAttribute("scrolling","no");b.src=OT.properties.assetURL+"/html/upgradeFlash.html"+(a?"?cf=1":"")+"#"+encodeURIComponent(document.location.href);return b}());c&&clearInterval(c);c=setInterval(function(){var a=document.location.hash,d=/^#?\d+&/;if(a!==b&&d.test(a)){b=a;if(a.replace(d,"")==="close_window"){document.body.removeChild(document.getElementById("_upgradeFlash"));document.location.hash=""}else if(a.replace(d,"")==="installed_gcf"){document.location.hash="";document.location.href=
document.location.href.replace("#","")}}},100)})};OT.reportIssue=function(){OT.warn("ToDo: haven't yet implemented TB.reportIssue")};OT.components={};OT.sessions={};OT.rtc={};OT.APIKEY=function(){var a=document.getElementsByTagName("script"),a=a[a.length-1],a=a.getAttribute("src")||a.src;return(a=a.match(/[\?\&]apikey=([^&]+)/i))?a[1]:""}();OT.HAS_REQUIREMENTS=1;OT.NOT_HAS_REQUIREMENTS=0;e.OT||(e.OT=OT);e.TB||(e.TB=OT)})(window);
(function(){OT.Event=function(e,c){this.type=e;this.cancelable=void 0!==c?c:!0;var b=!1,a=null;this.preventDefault=function(){this.cancelable?b=!0:OT.warn("Event.preventDefault :: Trying to preventDefault on an Event that isn't cancelable")};this.isDefaultPrevented=function(){return b};OT.$.canDefineProperty&&Object.defineProperty(this,"target",{set:function(b){a=b},get:function(){return a}})};OT.Event.names={ACTIVE:"active",INACTIVE:"inactive",UNKNOWN:"unknown",PER_SESSION:"perSession",PER_STREAM:"perStream",
EXCEPTION:"exception",ISSUE_REPORTED:"issueReported",SESSION_CONNECTED:"sessionConnected",SESSION_DISCONNECTED:"sessionDisconnected",STREAM_CREATED:"streamCreated",STREAM_DESTROYED:"streamDestroyed",CONNECTION_CREATED:"connectionCreated",CONNECTION_DESTROYED:"connectionDestroyed",SIGNAL:"signal",STREAM_PROPERTY_CHANGED:"streamPropertyChanged",MICROPHONE_LEVEL_CHANGED:"microphoneLevelChanged",ARCHIVE_CREATED:"archiveCreated",ARCHIVE_CLOSED:"archiveClosed",ARCHIVE_LOADED:"archiveLoaded",ARCHIVE_SAVED:"archiveSaved",
SESSION_RECORDING_STARTED:"sessionRecordingStarted",SESSION_RECORDING_STOPPED:"sessionRecordingStopped",SESSION_RECORDING_IN_PROGRESS:"sessionRecordingInProgress",STREAM_RECORDING_IN_PROGRESS:"streamRecordingInProgress",SESSION_NOT_RECORDING:"sessionNotRecording",STREAM_NOT_RECORDING:"streamNotRecording",STREAM_RECORDING_STARTED:"streamRecordingStarted",STREAM_RECORDING_STOPPED:"streamRecordingStopped",PLAYBACK_STARTED:"playbackStarted",PLAYBACK_PAUSED:"playbackPaused",PLAYBACK_STOPPED:"playbackStopped",
RECORDING_STARTED:"recordingStarted",RECORDING_STOPPED:"recordingStopped",RESIZE:"resize",SETTINGS_BUTTON_CLICK:"settingsButtonClick",DEVICE_INACTIVE:"deviceInactive",INVALID_DEVICE_NAME:"invalidDeviceName",ACCESS_ALLOWED:"accessAllowed",ACCESS_DENIED:"accessDenied",ACCESS_DIALOG_OPENED:"accessDialogOpened",ACCESS_DIALOG_CLOSED:"accessDialogClosed",ECHO_CANCELLATION_MODE_CHANGED:"echoCancellationModeChanged",DEVICES_DETECTED:"devicesDetected",DEVICES_SELECTED:"devicesSelected",CLOSE_BUTTON_CLICK:"closeButtonClick",
MICLEVEL:"microphoneActivityLevel",MICGAINCHANGED:"microphoneGainChanged",ENV_LOADED:"envLoaded"};OT.ValueEvent=function(e,c){OT.Event.call(this,e);this.value=c};OT.ExceptionCodes={JS_EXCEPTION:2E3,AUTHENTICATION_ERROR:1004,INVALID_SESSION_ID:1005,CONNECT_FAILED:1006,CONNECT_REJECTED:1007,CONNECTION_TIMEOUT:1008,P2P_CONNECTION_FAILED:1013,API_RESPONSE_FAILURE:1014,UNABLE_TO_PUBLISH:1500,UNABLE_TO_SIGNAL:1510,UNABLE_TO_FORCE_DISCONNECT:1520,UNABLE_TO_FORCE_UNPUBLISH:1530};OT.ExceptionEvent=function(e,
c,b,a,d,f){OT.Event.call(this,e);this.message=c;this.title=b;this.code=a;this.component=d;this.target=f};OT.IssueReportedEvent=function(e,c){OT.Event.call(this,e);this.issueId=c};OT.EnvLoadedEvent=function(e){OT.Event.call(this,e)};OT.ConnectionEvent=function(e,c,b){OT.Event.call(this,e);this.connections=c;this.reason=b};OT.StreamEvent=function(e,c,b,a){OT.Event.call(this,e,a);this.streams=c;this.reason=b};OT.SessionConnectEvent=function(e,c,b,a){OT.Event.call(this,e);this.connections=c;this.streams=
b;this.archives=a;this.groups=[]};OT.SessionDisconnectEvent=function(e,c,b){OT.Event.call(this,e,b);this.reason=c};OT.VolumeEvent=function(e,c,b){OT.Event.call(this,e);this.streamId=c;this.volume=b};OT.DeviceEvent=function(e,c,b){OT.Event.call(this,e);this.camera=c;this.microphone=b};OT.DeviceStatusEvent=function(e,c,b,a,d){OT.Event.call(this,e);this.cameras=c;this.microphones=b;this.selectedCamera=a;this.selectedMicrophone=d};OT.ResizeEvent=function(e,c,b,a,d){OT.Event.call(this,e);this.widthFrom=
c;this.widthTo=b;this.heightFrom=a;this.heightTo=d};OT.StreamPropertyChangedEvent=function(e,c,b,a,d){OT.Event.call(this,e);this.type=e;this.stream=c;this.changedProperty=b;this.oldValue=a;this.newValue=d};OT.ArchiveEvent=function(e,c){OT.Event.call(this,e);this.archives=c};OT.ArchiveStreamEvent=function(e,c,b){OT.Event.call(this,e);this.archive=c;this.streams=b};OT.StateChangedEvent=function(e,c){OT.Event.call(this,e);this.changedValues=c};OT.ChangeFailedEvent=function(e,c,b,a){OT.Event.call(this,
e);this.reasonCode=c;this.reason=b;this.failedValues=a};OT.SignalEvent=function(e,c,b){OT.Event.call(this,e?"signal:"+e:OT.Event.names.SIGNAL,!1);this.data=c;this.from=b}})(window);
(function(){OT.WebSocketMessageType={CONNECTED_TO_WEBSOCKET_SERVER:1E3,CONNECT_TO_SESSION:1001,SIGNAL:1002,CONNECTION_CREATED:1003,CONNECTION_DESTROYED:1004,CONNECTION_COUNT_CHANGED:1005,STREAM_CREATED:1006,STREAM_MODIFIED:1007,STREAM_DESTROYED:1008,FORCE_DISCONNECT:1009,FORCE_UNPUBLISH:1010,JSEP_OFFER:1011,JSEP_ANSWER:1012,JSEP_PRANSWER:1013,JSEP_CANDIDATE:1014,JSEP_SUBSCRIBE:1015,JSEP_UNSUBSCRIBE:1016,WEBSOCKET_PING:1017,WEBSOCKET_PONG:1018,STREAM_REGISTERED:1019,SUBSCRIBER_MODIFIED:1020,SUBSCRIBER_QUALITYCHANGED:1022,
SESSION_CONNECT_FAILED:1100,PUBLISH_FAILED:1101,SUBSCRIBE_FAILED:1102,FORCEDISCONNECT_FAILED:1103,FORCEUNPUBLISH_FAILED:1104}})(window);
(function(){OT.WebSocketMessage=function(e,c){this.type=e;this.payload=c;this.toString=function(){return JSON.stringify(this)}};OT.WebSocketMessage.connectToSessionMessage=function(e,c,b,a,d){return{type:OT.WebSocketMessageType.CONNECT_TO_SESSION,payload:{sessionId:e,apiKey:c,token:b,supportsWebRTC:OT.$.supportsWebRTC(),connectionObjects:a,p2pEnabled:d}}};OT.WebSocketMessage.createStream=function(e,c,b,a,d,f,h,i){return{type:OT.WebSocketMessageType.STREAM_CREATED,payload:{publisherId:e,name:c,orientation:{videoOrientation:b,
width:a,height:d},hasAudio:f,hasVideo:h,p2pEnabled:i}}};OT.WebSocketMessage.modifyStream=function(e,c,b){return{type:OT.WebSocketMessageType.STREAM_MODIFIED,payload:{streamId:e,key:c,value:b}}};OT.WebSocketMessage.destroyStream=function(e){return{type:OT.WebSocketMessageType.STREAM_DESTROYED,payload:{streamId:e}}};OT.WebSocketMessage.jsepMessage=function(e,c,b,a){a.fromAddress=e;a.toAddresses=c;return{type:b,payload:a}};OT.WebSocketMessage.forceDisconnect=function(e){return{type:OT.WebSocketMessageType.FORCE_DISCONNECT,
payload:{connectionId:e}}};OT.WebSocketMessage.forceUnpublish=function(e){return{type:OT.WebSocketMessageType.FORCE_UNPUBLISH,payload:{streamId:e}}};OT.WebSocketMessage.pingMessage=function(e,c){return{type:OT.WebSocketMessageType.WEBSOCKET_PING,payload:{message:c,timestamp:(+Date.now()).toString()}}};OT.WebSocketMessage.pongMessage=function(e,c){return{type:OT.WebSocketMessageType.WEBSOCKET_PONG,payload:{message:e,timestamp:parseInt(c,10)}}};OT.WebSocketMessage.modifySubscriber=function(e,c,b){return{type:OT.WebSocketMessageType.SUBSCRIBER_MODIFIED,
payload:{streamId:e,key:c,value:b}}};OT.WebSocketMessage.signalMessage=function(e,c,b){var a=b||{},d=null;this.id=uuid();this.signal={};a.type&&(this.signal.type=a.type);a.data&&(this.signal.data=a.data);this.onSuccess=a.success&&OT._.isFunction(a.success)?OT.$.createAsyncHandler(a.success):null;this.onError=a.error&&OT._.isFunction(a.error)?OT.$.createAsyncHandler(a.error):null;var b=function(){if(a.hasOwnProperty("to")){if(a.to){if(a.to instanceof OT.Connection||a.to instanceof OT.Session)return null;
if(OT._.isArray(a.to)){for(var b=0;b<a.to.length;b++)if(!(a.to[b]instanceof OT.Connection||a.to[b]instanceof OT.Session))return{code:400,reason:"The To field was invalid"};return null}return{code:400,reason:"The To field was invalid"}}return{code:400,reason:"The To field was null or undefined. Either set it to a String value or omit it"}}return null},f=function(){var b=null;a.hasOwnProperty("type")&&(a.type?a.type.length>128?b={code:413,reason:"The signal type was too long, the maximum length of it is 128 characters"}:
/^[a-zA-Z0-9\-\._~]+$/.exec(a.type)||(b={code:400,reason:"The signal type was invalid, it can only contain letters, numbers, '-', '_', and '~'."}):b={code:400,reason:"The signal type was null or undefined. Either set it to a String value or omit it"});return b};this.toJson=function(){return d};this.error=function(){if(!a.hasOwnProperty("data"))return null;var b=null;if(a.data)try{JSON.stringify(a.data).length>8192&&(b={code:413,reason:"The data field was too long, the maximum size of it is 8192 characters"})}catch(d){b=
{code:400,reason:"The data field was not valid JSON"}}else b={code:400,reason:"The signal data was null or undefined. Either set it to a String value or omit it"};return b}();this.error||(this.error=b());this.error||(this.error=f());if(this.valid=null===this.error)this.signal.to=a.to&&!OT._.isArray(a.to)?[a.to]:!a.to||0===a.to.length?[e]:a.to,e={id:this.id,toAddresses:OT._.map(this.signal.to,function(a){return typeof a==="string"?a:a.id}),fromAddress:c},a.type&&(e.type=a.type),a.data&&(e.data=JSON.stringify(a.data)),
d=JSON.stringify({type:OT.WebSocketMessageType.SIGNAL,payload:e});a=null}})(window);
(function(e){function c(b,a,d){this.code=b;this.reason=a;this.signal=d}OT.Messenger=function(b,a){function d(){OT.debug("WebSocket connected");clearTimeout(q);q=setTimeout(function(){x("Failure","reason","Connection to the server timed out waiting to receive connected message.");w.trigger("exception","Connection to the server timed out waiting to receive connected message.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15E3)}function f(a){OT.debug("WebSocket error: "+a.data);w.trigger("exception","TB.Socket Error :: The socket to "+
b+" received an error: "+a.data,OT.ExceptionCodes.CONNECT_FAILED)}function h(){clearTimeout(u);w.trigger("ConnectionClosed",{reason:y?"clientDisconnected":"networkDisconnected"});A=null;r=!1}function i(a){OT.warn("WebSocket message recieved: "+a.data);j(a.data)}function j(b){var d=JSON.parse(b);switch(d.type){case OT.WebSocketMessageType.CONNECTED_TO_WEBSOCKET_SERVER:m(d.payload);break;case OT.WebSocketMessageType.WEBSOCKET_PONG:B=+Date.now();break;case OT.WebSocketMessageType.CONNECT_TO_SESSION:clearTimeout(q),
r=!0,A=d.payload.connectionId,k();default:if(n.hasOwnProperty(d.type)){var c=n[d.type].type;OT.debug("Received "+c);!r&&n[d.type].afterConnected?g.push(b):w.trigger(c,a.wrangle(d.payload))}else OT.debug("Message type "+d.type+" was not handled.");if(d.type===OT.WebSocketMessageType.CONNECT_TO_SESSION)for(;0<g.length;)j(g.shift())}}function k(){var a;a=B?+Date.now()-B>=t:!1;a?(OT.error("We seem to have lost connectivity!"),h()):(w.sendMessage(OT.WebSocketMessage.pingMessage(w.connectionId,"ping!")),
u=setTimeout(k,o))}function m(a){w.connectionId=a.connectionId;x("Success","webSocketServerUrl",_webSocketUrl,{connectionId:a.connectionId});clearTimeout(q);q=setTimeout(function(){x("Failure","reason","Connection to the server timed out waiting to receive connected message.");w.trigger("exception","Connection to the server timed out fetching the session state.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15E3);w.sendMessage(OT.WebSocketMessage.connectToSessionMessage(s,OT.APIKEY,p,v.requireConnectionObjects,
v.p2pEnabled))}var n={};n[OT.WebSocketMessageType.CONNECT_TO_SESSION]={type:"SessionConnected",afterConnected:!1};n[OT.WebSocketMessageType.SESSION_CONNECT_FAILED]={type:"SessionConnectFailed",afterConnected:!1};n[OT.WebSocketMessageType.CONNECTION_CREATED]={type:"ConnectionCreated",afterConnected:!0};n[OT.WebSocketMessageType.CONNECTION_DESTROYED]={type:"ConnectionDestroyed",afterConnected:!0};n[OT.WebSocketMessageType.STREAM_CREATED]={type:"StreamCreated",afterConnected:!0};n[OT.WebSocketMessageType.STREAM_MODIFIED]=
{type:"StreamModified",afterConnected:!0};n[OT.WebSocketMessageType.STREAM_DESTROYED]={type:"StreamDestroyed",afterConnected:!0};n[OT.WebSocketMessageType.STREAM_REGISTERED]={type:"StreamRegistered",afterConnected:!0};n[OT.WebSocketMessageType.JSEP_OFFER]={type:"JSEPMessageReceived",afterConnected:!0};n[OT.WebSocketMessageType.JSEP_ANSWER]={type:"JSEPMessageReceived",afterConnected:!0};n[OT.WebSocketMessageType.JSEP_PRANSWER]={type:"JSEPMessageReceived",afterConnected:!0};n[OT.WebSocketMessageType.JSEP_CANDIDATE]=
{type:"JSEPMessageReceived",afterConnected:!0};n[OT.WebSocketMessageType.JSEP_SUBSCRIBE]={type:"JSEPMessageReceived",afterConnected:!0};n[OT.WebSocketMessageType.JSEP_UNSUBSCRIBE]={type:"JSEPMessageReceived",afterConnected:!0};n[OT.WebSocketMessageType.SIGNAL]={type:"SignalReceived",afterConnected:!0};n[OT.WebSocketMessageType.SUBSCRIBER_QUALITYCHANGED]={type:"SubscriberQualityChanged",afterConnected:!0};var o=25E3,t=3*o-100;OT.$.eventing(this);this.connectionId=this.webSocket=this.onConnectionClosed=
this.onSessionConnected=null;var s,p,v,q,u,y=!1,z=new OT.Analytics,g=[],r=!1,A,B=null,x=function(a,b,d,c){a={action:"webSocketConnection",variation:a,payload_type:b,payload:d,session_id:s,partner_id:v.partnerId,widget_id:v.widgetId,widget_type:"Controller"};c&&(a=OT._.extend(c,a));z.logEvent(a)};this.connect=function(a,c,g){s=a;p=c;v=g;_webSocketUrl="wss://"+b+":443/rumorwebsockets";x("Attempt","webSocketServerUrl|userAgent|sdkVersion|chromeFrame",[_webSocketUrl,navigator.userAgent,OT.properties.version,
e.externalHost?"yes":"no"].map(function(a){return a.replace("|","\\|")}).join("|"));this.webSocket=new WebSocket(_webSocketUrl);this.webSocket.onopen=d;this.webSocket.onclose=h;this.webSocket.onerror=f;this.webSocket.onmessage=i;q=setTimeout(function(){x("Failure","reason","Connection to the server timed out waiting to receive connected message.");w.trigger("exception","Connection to the server timed out.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15E3)};this.disconnect=function(){y=!0;this.webSocket&&
(this.webSocket.close(),this.webSocket=null)};this.sendMessage=function(a){OT.warn("Sending WebSocket message: "+JSON.stringify(a));this.webSocket.send(JSON.stringify(a))};this.signal=function(a){var b=new OT.WebSocketMessage.signalMessage(s,A,a),a=function(){if(b.onError)b.onError(new c(b.error.code,b.error.reason,b.signal))};if(b.valid){OT.warn("Sending WebSocket signal: "+b.toJson());try{if(this.webSocket.send(b.toJson()),b.onSuccess)b.onSuccess(b.signal)}catch(d){a()}}else a()};var w=this}})(window);
(function(){var e=new function(){var c=!1,b=!1,a=function(){b&&c&&OT.dispatchEvent(new OT.EnvLoadedEvent(OT.Event.names.ENV_LOADED))},d=function(){b=!0;OT.Config.load(OT.properties.configURL);a()},e=function(){c=!0;OT.Config.off("dynamicConfigChanged",e);OT.Config.off("dynamicConfigLoadFailed",h);a()},h=function(){e()};OT.Config.on("dynamicConfigChanged",e);OT.Config.on("dynamicConfigLoadFailed",h);"complete"==document.readyState||"interactive"==document.readyState&&document.body?d():document.addEventListener?
document.addEventListener("DOMContentLoaded",d,!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"==document.readyState&&d()});this.onLoad=function(a){if(b&&c)a();else OT.on(OT.Event.names.ENV_LOADED,a)}};OT.onLoad=function(c,b){if(b)e.onLoad(OT._.bind(c,b));else e.onLoad(c)}})(window);
(function(){function e(a,d,e,h){var i=c[e],h=h?OT._.clone(h):{};OT.error("TB.exception :: title: "+i+" ("+e+") msg: "+d);h.partnerId||(h.partnerId=OT.APIKEY);try{b||(b=new OT.Analytics),b.logError(e,"tb.exception",i,{details:d},h),OT.dispatchEvent(new OT.ExceptionEvent(OT.Event.names.EXCEPTION,d,i,e,a,a))}catch(j){OT.error("TB.exception :: Failed to dispatch exception - "+j.toString())}}var c={1E3:"Failed To Load",1004:"Authentication error",1005:"Invalid Session ID",1006:"Connect Failed",1007:"Connect Rejected",
1008:"Connect Time-out",1009:"Security Error",1010:"Not Connected",1011:"Invalid Parameter",1012:"Peer-to-peer Stream Play Failed",1013:"Connection Failed",1014:"API Response Failure",1500:"Unable to Publish",1510:"Unable to Signal",1520:"Unable to Force Disconnect",1530:"Unable to Force Unpublish",1540:"Unable to record archive",1550:"Unable to play back archive",1560:"Unable to create archive",1570:"Unable to load archive",2E3:"Internal Error",2001:"Embed Failed",3E3:"Archive load exception",3001:"Archive create exception",
3002:"Playback stop exception",3003:"Playback start exception",3004:"Record start exception",3005:"Record stop exception",3006:"Archive load exception",3007:"Session recording in progress",3008:"Archive recording internal failure",4E3:"WebSocket Connection Failed",4001:"WebSocket Network Disconnected"},b;OT.handleJsException=function(a,b,c){var c=c||{},h,i=c.session;if(i){if(h={sessionId:i.sessionId},i.connected&&(h.connectionId=i.connection.connectionId),!c.target)c.target=i}else c.sessionId&&(h=
{sessionId:c.sessionId},c.target||(c.target=null));e(c.target,a,b,h)};OT.exceptionHandler=function(a,b,c,h,i){var j;a&&((j=OT.components[a])||OT.warn("Could not find the component with component ID "+a));e(j,b,h,i)}})(window);(function(){OT.ConnectionCapabilities=function(e){e.supportsWebRTC=OT.$.castToBoolean(e.supportsWebRTC);this.supportsWebRTC=e.supportsWebRTC}})(window);
(function(){OT.Connection=function(e,c,b,a){this.id=this.connectionId=e;this.creationTime=Number(c);this.data=b;this.capabilities=new OT.ConnectionCapabilities(a);this.quality=null;OT.$.eventing(this)}})(window);
(function(){OT.Stream=function(e,c,b,a,d,f,h,i,j,k,m,n,o){this.id=this.streamId=e;this.connection=c;this.name=b;this.data=a;this.type=d||"basic";this.creationTime=Number(f);this.hasAudio=OT.$.castToBoolean(h,!0);this.hasVideo=OT.$.castToBoolean(i,!0);this.orientation=j;this.peerId=k;this.quality=m;this.videoDimensions={width:n,height:o};OT.$.eventing(this);this.update=function(a,b){switch(a){case "hasAudio":case "hasVideo":this[a]=OT.$.castToBoolean(b,!0);break;case "quality":case "name":case "videoDimensions":case "orientation":this[a]=
b}};this.startRecording=function(){OT.debug("OT.Stream.startRecording");throw Error("OT.Stream.startRecording: Is not implemented yet.");};this.stopRecording=function(){OT.debug("OT.Stream.stopRecording");throw Error("OT.Stream.stopRecording: Is not implemented yet.");}}})(window);
(function(){OT.DOMComponentCleanup=function(){var e={},c={},b=function(b){OT.$.on(b,"unload",function(){return a(b)})},a=function(a){c[a]&&0!==c[a].length&&(c[a].slice().forEach(function(a){a.destroy()}),delete c[a])};return{add:function(a){if(a.targetElement&&a.id){var f=a.targetElement.ownerDocument.defaultView;e[a.id]=f;c.hasOwnProperty(f)||(c[f]=[],b(f));c[f].push(a)}},remove:function(a){if(a.id&&e[a.id]){var b=e[a.id],h;-1!=(h=OT._.indexOf(c[b],a))&&c[b].splice(h,1)}}}}()})(window);
(function(e){var c=e.webkitRTCPeerConnection||e.mozRTCPeerConnection,b=e.mozRTCSessionDescription||e.RTCSessionDescription,a=e.mozRTCIceCandidate||e.RTCIceCandidate,d=function(a){return function(b){OT.debug("IceCandidateForwarder: Ice Candidate");b.candidate?a(OT.WebSocketMessageType.JSEP_CANDIDATE,{candidate:b.candidate}):OT.debug("IceCandidateForwarder: No more ICE candidates. PeerConnection Status: "+b.srcElement.readyState+", Ice Status: "+b.srcElement.iceState)}},f=function(){var b=[],d=null;
Object.defineProperty(this,"peerConnection",{set:function(a){d=a}});this.process=function(c){c=new a(c.candidate);d?d.addIceCandidate(c):b.push(c)};this.processPending=function(){for(;b.length;)d.addIceCandidate(b.shift())}},h=function(a,b,d,c){var e=function(a){return function(b){c&&c(a,b)}},f=function(b){a.setLocalDescription(b,function(){d(b)},e("Error while setting LocalDescription"))};-1===b.sdp.indexOf("a=crypto")&&(b.sdp=b.sdp.replace(/^c=IN(.*)$/gmi,"c=IN$1\r\na=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:FakeFakeFakeFakeFakeFakeFakeFakeFakeFake\\r\\n"));
-1===b.sdp.indexOf("a=rtcp-fb")&&(b.sdp=b.sdp.replace(/^m=video(.*)$/gmi,"m=video$1\r\na=rtcp-fb:* ccm fir\r\na=rtcp-fb:* nack "));a.setRemoteDescription(b,function(){a.createAnswer(f,e("Error while setting createAnswer"),null,false)},e("Error while setting RemoteDescription"))},i=function(a,b,d){var c={mandatory:{},optional:[]},e=function(a){return function(b){d&&d(a,b)}};navigator.mozGetUserMedia&&(c.mandatory.MozDontOfferDataChannel=!0);a.createOffer(function(d){a.setLocalDescription(d,function(){b(d)},
e("Error while setting LocalDescription"))},e("Error while creating Offer"),c)};OT.PeerConnection=function(a){var e,m=new f,n,o,t="new",s=[],p,v=OT.$.now(),q={timeStamp:v};OT.$.eventing(this);a.iceServers||(a.iceServers=[]);var u;if(0<a.iceServers.length&&(u=navigator.userAgent.match(/(Firefox)\/([0-9]+\.[0-9]+)/)))a.iceServers=23>parseFloat(u[2],10)?a.iceServers.map(function(a){return{url:a.url.replace("turn:","stun:")}}):a.iceServers.map(function(a){if(a.url.trim().substr(0,5)!=="turn:")return a;
var b=a.url.trim().split(/[:@]/);return{username:b[1],credential:a.credential,url:b[0]+":"+b[2]}});var y=OT._.bind(function(a,b){if(s.length)s[0](a,b)},this),z=OT._.bind(function(){if(!e){try{OT.debug('Creating peer connection config "'+JSON.stringify(a)+'".');e=new c(a,{optional:[{DtlsSrtpKeyAgreement:true}]})}catch(b){OT.error("Failed to create PeerConnection, exception: "+b.message);return null}m.peerConnection=e;e.onicecandidate=d(y);e.onaddstream=OT._.bind(r,this);e.onremovestream=OT._.bind(A,
this);if(e.onsignalingstatechange!==void 0)e.onsignalingstatechange=OT._.bind(g,this);else if(e.onstatechange!==void 0)e.onstatechange=OT._.bind(g,this)}return e},this),g=function(a){if((a=a.target.signalingState||a.target.readyState)&&a.toLowerCase()!==t){t=a.toLowerCase();OT.debug("PeerConnection.stateChange: "+t);switch(t){case "closed":if(m)m.peerConnection=null;e=null;this.trigger("close")}}},r=function(a){this.trigger("streamAdded",a.stream,a.type==="audio"||a.type==="video"?a.type:"merged")},
A=function(a){this.trigger("streamRemoved",a.stream,a.type==="audio"||a.type==="video"?a.type:"merged")},B=function(a){a=new b(a.sdp);z();_remoteDescriptionType=a.type;_remoteDescription=a;h(e,a,function(a){y(OT.WebSocketMessageType.JSEP_ANSWER,{sdp:a})},function(a,b){w("PeerConnection.offerProcessor "+a+": "+b)})},x=function(){OT.debug("PeerConnection.processSubscribe: Sending offer to subscriber.");z();i(e,function(a){n=a;y(OT.WebSocketMessageType.JSEP_OFFER,{sdp:n})},function(a,b){w("PeerConnection.suscribeProcessor "+
a+": "+b)})},w=OT._.bind(function(a){OT.error(a);this.trigger("error",a)},this);this.addLocalStream=function(a){z();e.addStream(a)};this.disconnect=function(){m=null;if(e){var a=e.signalingState||e.readyState;a&&a.toLowerCase()!=="closed"&&e.close();e=null}this.off()};this.processMessage=function(a,d){OT.debug("PeerConnection.processMessage: Received "+a+" from "+d.fromAddress);OT.debug(d);switch(a){case OT.WebSocketMessageType.JSEP_SUBSCRIBE:x.call(this,d);break;case OT.WebSocketMessageType.JSEP_OFFER:B.call(this,
d);break;case OT.WebSocketMessageType.JSEP_ANSWER:if(d.sdp){o=new b(d.sdp);_remoteDescriptionType=o.type;_remoteDescription=o;e.setRemoteDescription(o);m.processPending()}else OT.error("PeerConnection.processMessage: Weird message, no SDP.");break;case OT.WebSocketMessageType.JSEP_CANDIDATE:m.process(d);break;default:OT.debug("PeerConnection.processMessage: Received an unexpected message of type "+a+" from "+d.fromAddress+": "+JSON.stringify(d))}return this};this.registerMessageDelegate=function(a){s.push(a)};
this.unregisterMessageDelegate=function(a){OT._.without(s,a)};this.getStats=function(a){if(p==true)w("PeerConnection.getStats: Already getting the stats!");else{p=true;var b=OT.$.now(),d=(b-q.timeStamp)/1E3;q.timeStamp=b;var c={},f=function(b){if(b.result)for(var b=b.result(),e=0;e<b.length;e++){var f=b[e];if(f.stat){var g;g=f;var h=q.videoBytesTransferred||0;if(g.stat("googFrameHeightSent")){q.videoBytesTransferred=g.stat("bytesSent");g=Math.round((q.videoBytesTransferred-h)*8/d)}else if(g.stat("googFrameHeightReceived")){q.videoBytesTransferred=
g.stat("bytesReceived");g=Math.round((q.videoBytesTransferred-h)*8/d)}else g=NaN;isNaN(g)||(c.avgVideoBitrate=g);g=q.audioBytesTransferred||0;if(f.stat("audioInputLevel")){q.audioBytesTransferred=f.stat("bytesSent");f=Math.round((q.audioBytesTransferred-g)*8/d)}else if(f.stat("audioOutputLevel")){q.audioBytesTransferred=f.stat("bytesReceived");f=Math.round((q.audioBytesTransferred-g)*8/d)}else f=NaN;isNaN(f)||(c.avgAudioBitrate=f)}}p=false;a(c)};c.duration=Math.round(b-v);if(e&&e.getStats)e.getStats(f);
else{p=false;a(c)}}};Object.defineProperty(this,"remoteStreams",{get:function(){var a;if(e){if(e.getRemoteStreams)a=e.getRemoteStreams();else if(e.remoteStreams)a=e.remoteStreams;else throw Error("Invalid Peer Connection object implements no method for retrieving remote streams");a=Array.prototype.slice.call(a)}else a=[];return a}})}})(window);
(function(){var e={};OT.PeerConnections={add:function(c,b,a){c=c.id+"_"+b.id;(b=e[c])||(b=e[c]={count:0,pc:new OT.PeerConnection(a)});b.count+=1;return b.pc},remove:function(c,b){var a=c.id+"_"+b.id,d=e[a];d&&(d.count-=1,0===d.count&&(d.pc.disconnect(),delete e[a]))}}})(window);
(function(){OT.PublisherPeerConnection=function(e,c,b,a){var d,f=!1,h=OT._.bind(function(a,d){if(!f){if(a===OT.WebSocketMessageType.JSEP_CANDIDATE||a===OT.WebSocketMessageType.JSEP_OFFER||a===OT.WebSocketMessageType.JSEP_ANSWER)f=-1!==(a===OT.WebSocketMessageType.JSEP_CANDIDATE?d.candidate.candidate:d.sdp.sdp).indexOf("typ relay");a===OT.WebSocketMessageType.JSEP_OFFER&&this.trigger("connected")}c.sendJSEPMessage(e,a,OT._.extend(d,{streamId:b.id}))},this);OT.$.eventing(this);this.destroy=function(){d&&
OT.PeerConnections.remove(e,b);d=null;this.off()};this.processMessage=function(a,b){d.processMessage(a,b)};this.getStats=function(a){d.getStats(a)};d=OT.PeerConnections.add(e,b,{iceServers:c.sessionInfo.iceServers?c.sessionInfo.iceServers:[{url:"stun:stun.l.google.com:19302"}]});d.on({close:OT._.bind(function(){this.destroy();this.trigger("disconnected",this)},this),error:OT._.bind(function(a){this.trigger("error",null,a,this);this.destroy()},this)});d.registerMessageDelegate(h);d.addLocalStream(a);
Object.defineProperty(this,"remoteConnection",{value:e});Object.defineProperty(this,"hasRelayCandidates",{get:function(){return f}})}})(window);
(function(){OT.SubscriberPeerConnection=function(e,c,b,a){var d,f={},h=!1,i=function(a,b){f[b]=a;this.trigger("remoteStreamAdded",f[b],b,this)},j=OT._.bind(function(a,d){if(!h&&(a===OT.WebSocketMessageType.JSEP_CANDIDATE||a===OT.WebSocketMessageType.JSEP_OFFER||a===OT.WebSocketMessageType.JSEP_ANSWER))h=-1!==(a===OT.WebSocketMessageType.JSEP_CANDIDATE?d.candidate.candidate:d.sdp.sdp).indexOf("typ relay");a===OT.WebSocketMessageType.JSEP_ANSWER&&this.trigger("connected");c.sendJSEPMessage(e,a,OT._.extend(d,
{streamId:b.id}))},this),k=function(a){var b="get"+(a?"Video":"Audio")+"Tracks";return function(a){var c=d.remoteStreams,e;if(0!==c.length&&c[0][b])for(var f=0,h=c.length;f<h;++f){e=c[f];e=e[b]();for(var i=0,j=e.length;i<j;++i)e[i].enabled=a}}};OT.$.eventing(this);this.destroy=function(){c&&(c.connected&&b)&&c.sendJSEPMessage(b.connection,OT.WebSocketMessageType.JSEP_UNSUBSCRIBE,{streamId:b.id});d&&(this.subscribeToAudio(!1),OT.PeerConnections.remove(e,b));f={};d=null;this.off()};this.processMessage=
function(a,b){d.processMessage(a,b)};this.getStats=function(a){d.getStats(a)};this.subscribeToAudio=k(!1);this.subscribeToVideo=k(!0);Object.defineProperty(this,"hasRelayCandidates",{get:function(){return h}});d=OT.PeerConnections.add(e,b,{iceServers:c.sessionInfo.iceServers?c.sessionInfo.iceServers:[{url:"stun:stun.l.google.com:19302"}]});d.on({close:OT._.bind(function(){this.destroy();this.trigger("disconnected",this)},this),streamAdded:OT._.bind(i,this),streamRemoved:OT._.bind(function(a,b){delete f[b];
this.trigger("remoteStreamRemoved",a,b,this)},this),error:OT._.bind(function(a){this.trigger("error",null,a,this)},this)});d.registerMessageDelegate(j);0<d.remoteStreams.length?d.remoteStreams.forEach(i,this):c.sendJSEPMessage(e,OT.WebSocketMessageType.JSEP_SUBSCRIBE,{streamId:b.id,keyManagemenMethod:OT.$.supportedCryptoScheme(),hasVideo:a.subscribeToVideo,hasAudio:a.subscribeToAudio})}})(window);
(function(){OT.Chrome=function(e){var c={},b=function(a,b){b.parent=this;b.appendTo(e.parent);c[a]=b;Object.defineProperty(this,a,{get:function(){return c[a]}})};e.parent&&(OT.$.eventing(this),this.destroy=function(){this.off();this.hide();for(var a in c)c[a].destroy()},this.show=function(){for(var a in c)c[a].show()},this.hide=function(){for(var a in c)c[a].hide()},this.set=function(a,d){if("string"===typeof a&&d)b.call(this,a,d);else for(var c in a)a.hasOwnProperty(c)&&b.call(this,c,a[c]);return this})}})(window);
(function(){OT.Chrome.Behaviour||(OT.Chrome.Behaviour={});OT.Chrome.Behaviour.Widget=function(e,c){var b=c||{},a,d;e.setDisplayMode=function(b){b=b||"auto";if(a!==b){OT.$.removeClass(this.domElement,"OT_mode-"+a);OT.$.addClass(this.domElement,"OT_mode-"+b);d=a;a=b}};e.show=function(){this.setDisplayMode(d);if(b.onShow)b.onShow();return this};e.hide=function(){this.setDisplayMode("off");if(b.onHide)b.onHide();return this};e.destroy=function(){if(b.onDestroy)b.onDestroy(this.domElement);this.domElement&&
OT.$.removeElement(this.domElement);return e};e.appendTo=function(a){this.domElement=OT.$.createElement(b.nodeName||"div",b.htmlAttributes,b.htmlContent);if(b.onCreate)b.onCreate(this.domElement);e.setDisplayMode("on");a.appendChild(this.domElement);setTimeout(function(){e.setDisplayMode(b.mode)},2E3);return e}}})(window);
(function(){OT.Chrome.NamePanel=function(e){var c=e.name;if(!c||""===c.trim().length)c=null,e.mode="off";var b;this.__defineGetter__("domElement",function(){return b});this.__defineSetter__("domElement",function(a){b=a});OT.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"h1",htmlContent:c,htmlAttributes:{className:"OT_name"}});this.__defineSetter__("name",OT._.bind(function(a){c||this.setDisplayMode("auto");c=a;b.innerHTML=c},this))}})(window);
(function(){OT.Chrome.MuteButton=function(e){var c,b=e.muted||!1,a;this.__defineGetter__("domElement",function(){return a});this.__defineSetter__("domElement",function(b){a=b});var d=function(){(b=!b)?(OT.$.addClass(a,"OT_active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"OT_active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:b?"OT_mute OT_active":"OT_mute"},onCreate:OT._.bind(function(a){c=
OT._.bind(d,this);a.addEventListener("click",c,!1)},this),onDestroy:OT._.bind(function(a){c=null;a.removeEventListener("click",c,!1)},this)})}})(window);
(function(){OT.Chrome.MicVolume=function(e){var c,b=e.muted||!1,a;this.__defineGetter__("domElement",function(){return a});this.__defineSetter__("domElement",function(b){a=b});var d=function(){(b=!b)?(OT.$.addClass(a,"active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:"OT_mic-volume"},onCreate:OT._.bind(function(a){c=OT._.bind(d,
this);a.addEventListener("click",c,!1)},this),onDestroy:OT._.bind(function(a){c=null;a.removeEventListener("click",c,!1)},this)})}})(window);
(function(){OT.Chrome.SettingsPanelButton=function(e){var c,b=function(){this.parent.trigger("SettingsPanel:open",this);return!1},a;this.__defineGetter__("domElement",function(){return a});this.__defineSetter__("domElement",function(b){a=b});OT.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"button",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:OT._.bind(function(a){c=OT._.bind(b,this);a.addEventListener("click",c,!1)},this),onDestroy:OT._.bind(function(a){c=null;
a.removeEventListener("click",c,!1)},this)})}})(window);
(function(){OT.Chrome.SettingsPanel=function(e){if(e.stream){var c=e.stream,b;this.__defineGetter__("domElement",function(){return b});this.__defineSetter__("domElement",function(a){b=a});var a=function(){var a=c.getVideoTracks().length?c.getVideoTracks()[0].label:"None",e=c.getAudioTracks().length?c.getAudioTracks()[0].label:"None";b.innerHTML="<dl>                                        <dt>Cam</dt>                                        <dd>"+a+"</dd>                                        <dt>Mic</dt>                                        <dd>"+
e+"</dd>                                    </dl>";a=OT.$.createButton("Close",{className:"OT_close"},{click:OT._.bind(d,this)});b.appendChild(a)},d=function(){this.parent.trigger("SettingsPanel:close",this);return!1};OT.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"section",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:OT._.bind(a,this),onShow:OT._.bind(function(){a.call(this)},this)})}}})(window);
(function(){OT.Chrome.OpenTokButton=function(e){var c;this.__defineGetter__("domElement",function(){return c});this.__defineSetter__("domElement",function(b){c=b});OT.Chrome.Behaviour.Widget(this,{mode:e?e.mode:null,nodeName:"span",htmlContent:"OpenTok",htmlAttributes:{className:"OT_opentok"}})}})(window);
(function(){OT.StylableComponent=function(c,b){if(!c.trigger)throw Error("OT.StylableComponent is dependent on the mixin OT.$.eventing. Ensure that this is included in the object before StylableComponent.");var a=new e(b,function(a,b,e){e?c.trigger("styleValueChanged",a,b,e):c.trigger("styleValueChanged",a,b)});c.getStyle=function(b){return a.get(b)};c.setStyle=function(b,c,e){"string"!==typeof b?a.setAll(b,e):a.set(b,c);return this}};var e=function(c,b){var a="showMicButton showSpeakerButton showSettingsButton showCameraToggleButton nameDisplayMode buttonDisplayMode showSaveButton showRecordButton showRecordStopButton showReRecordButton showPauseButton showPlayButton showPlayStopButton showStopButton backgroundImageURI showControlPanel showRecordCounter showPlayCounter showControlBar showPreviewTime".split(" "),
d={buttonDisplayMode:["auto","off","on"],nameDisplayMode:["auto","off","on"],showSettingsButton:[!0,!1],showMicButton:[!0,!1],showCameraToggleButton:[!0,!1],showSaveButton:[!0,!1],backgroundImageURI:null,showControlBar:[!0,!1],showPlayCounter:[!0,!1],showRecordCounter:[!0,!1],showPreviewTime:[!0,!1]},e={},h=function(a,b){return"backgroundImageURI"===a||d.hasOwnProperty(a)&&OT._.include(d[a],b)},i=function(a){switch(a){case "true":return!0;case "false":return!1;default:return a}};this.getAll=function(){var b=
OT._.clone(e),d;for(d in b)0>a.indexOf(d)&&delete b[d];return b};this.get=function(a){return a?e[a]:this.getAll()};this.setAll=function(a,d){var c,n,o;for(o in a)n=i(a[o]),h(o,n)?(c=e[o],n!==c&&(e[o]=n,d||b(o,n,c))):OT.warn("Style.setAll::Invalid style property passed "+o+" : "+n);return this};this.set=function(a,d){OT.debug("Publisher.setStyle: "+a.toString());var c=i(d),n;if(!h(a,c))return OT.warn("Style.set::Invalid style property passed "+a+" : "+c),this;n=e[a];c!==n&&(e[a]=c,b(a,d,n));return this};
c&&this.setAll(c,!0)}})(window);(function(){OT.Microphone=function(e,c){var b,a=50;Object.defineProperty(this,"muted",{get:function(){return b},set:function(a){if(b!==a){b=a;for(var a=e.getAudioTracks(),c=0,h=a.length;c<h;++c)a[c].enabled=!b}}});Object.defineProperty(this,"gain",{get:function(){return a},set:function(b){OT.warn("OT.Microphone.gain IS NOT YET IMPLEMENTED");a=b}});this.muted=void 0!==c?!0===c:e.getAudioTracks().length?!e.getAudioTracks()[0].enabled:!1}})(window);
(function(){OT.Publisher=function(){if(OT.checkSystemRequirements()){var e=OT.Publisher.nextId(),c,b,a,d,f,h,i={},j=!1,k,m,n,o,t=new OT.Analytics,s={};OT.$.eventing(this);OT.StylableComponent(this,{showMicButton:!0,showSettingsButton:!0,showCameraToggleButton:!0,nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var p=function(a,b,c,f){t.logEvent({action:a,variation:b,payload_type:c,payload:f,session_id:h?h.sessionId:null,connection_id:h&&h.connected?h.connection.connectionId:
null,partner_id:h?h.apiKey:OT.APIKEY,streamId:d?d.id:null,widget_id:e,widget_type:"Publisher"})},v=function(a){var b={widget_type:"Publisher",stream_type:"WebRTC",sessionId:h?h.sessionId:null,connectionId:h&&h.connected?h.connection.connectionId:null,partnerId:h?h.apiKey:OT.APIKEY,streamId:d?d.id:null,widgetId:e,version:OT.properties.version,media_server_name:h?h.sessionInfo.messagingServer:null,duration:(new Date).getTime()-m.getTime(),remote_connection_id:a};i[a].getStats(function(a){if(a)for(stat_index in a)b[stat_index]=
a[stat_index];t.logQOS(b)})},q=function(){OT.debug("OT.Publisher.onLoaded");p("publish","Success","streamType","WebRTC");b.loading=!1;D.call(this);j=!0;this.trigger("loaded",this)},u=function(a){p("publish","Failure","reason","Publisher PeerConnection Error: "+a);OT.handleJsException("Publisher PeerConnection Error: "+a,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:h,target:this})},y=function(c){OT.debug("OT.Publisher.onStreamAvailable");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_ALLOWED,
!1));f&&(f.stop(),f=null);f=c;n=new OT.Microphone(f,!k.publishAudio);this.publishVideo(k.publishVideo);a=new OT.VideoElement({attributes:{muted:!0}});a.on({streamBound:OT._.bind(q,this),timeout:OT._.bind(u,this),error:OT._.bind(A,this)}).bindToStream(f);b.video=a;OT.DOMComponentCleanup.add(this,a)},z=function(a){var c=function(a,b){OT.error("OT.Publisher.onStreamAvailableError "+a);p("publish","Failure","reason","Publisher failed to access camera/mic: "+a);OT.handleJsException("Publisher failed to access camera/mic: "+
a,2E3,{session:h,target:b})};switch(a.code){case 1:OT.error("OT.Publisher.onStreamAvailableError Permission Denied");p("publish","Failure","reason","Publisher Access Denied: Permission Denied ("+a.code+")");var d=new OT.Event(OT.Event.names.ACCESS_DENIED);this.dispatchEvent(d,function(){!d.isDefaultPrevented()&&b&&b.destroy()});break;case "NO_CONSTRAINTS":b&&b.destroy();c("No constaints were provided",this);break;default:b&&b.destroy(),c("Unknown Reason ("+a.code+")",this)}},g=function(){p("accessDialog",
"Opened","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_OPENED,!1))},r=function(){p("accessDialog","Closed","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_CLOSED,!1))},A=function(a,b){OT.error("OT.Publisher.onVideoError");var c=b+(a?" ("+a+")":"");p("stream",null,"reason","Publisher while playing stream: "+c);OT.handleJsException("Publisher error playing stream: "+c,2E3,{session:h,target:this})},B=function(a){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");
this.cleanupSubscriber(a.remoteConnection.id)},x=function(a,b,c){p("publish","Failure","reason|hasRelayCandidates",["Publisher PeerConnection with connection "+c.remoteConnection.id+" failed: "+b,c.hasRelayCandidates].join("|"));OT.handleJsException("Publisher PeerConnection Error: "+b,2E3,{session:h,target:this});clearInterval(s[c.remoteConnection.id]);delete s[c.remoteConnection.id];delete i[c.remoteConnection.id]},w=function(a){var b=i[a.id];if(!b){var c=OT.$.now();p("createPeerConnection","Attempt",
"","");b=i[a.id]=new OT.PublisherPeerConnection(a,h,d,f);b.on({connected:function(){p("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(OT.$.now()-c,10),b.hasRelayCandidates].join("|"));s[a.id]=setInterval(function(){v(a.id)},3E4)},disconnected:OT._.bind(B,this),error:OT._.bind(x,this)})}return b},E=function(a){if(!1===a)return"off";a=this.getStyle("buttonDisplayMode");return!1===a?"on":a},D=function(){o=(new OT.Chrome({parent:b.domElement})).set({name:new OT.Chrome.NamePanel({name:k.name,
mode:this.getStyle("nameDisplayMode")}),muteButton:new OT.Chrome.MuteButton({muted:!1===k.publishAudio,mode:E.call(this,this.getStyle("showMicButton"))}),opentokButton:new OT.Chrome.OpenTokButton}).on({muted:OT._.bind(function(){this.publishAudio(!1)},this),unmuted:OT._.bind(function(){this.publishAudio(!0)},this)})};this.publish=function(a,d){OT.debug("OT.Publisher: publish");c&&this.unpublish();k=OT._.defaults(d||{},{publishAudio:!0,publishVideo:!0,mirror:!0});k.style&&this.setStyle(k.style,null,
!0);k.name&&(k.name=k.name.toString());k.classNames="OT_root OT_publisher";OT.onLoad(function(){b=new OT.WidgetView(a,k);c=b.domId;OT.$.getUserMedia({audio:true,video:true},OT._.bind(y,this),OT._.bind(z,this),OT._.bind(g,this),OT._.bind(r,this))},this);return this};this.publishAudio=function(a){k.publishAudio=a;n.muted=!a;h&&d&&h.sendMessage(OT.WebSocketMessage.modifyStream(d.streamId,"hasAudio",a))};this.publishVideo=function(a){var c=k.publishVideo;k.publishVideo=a;h&&(d&&k.publishVideo!==c)&&h.sendMessage(OT.WebSocketMessage.modifyStream(d.streamId,
"hasVideo",a));for(var c=f.getVideoTracks(),e=0,g=c.length;e<g;++e)c[e].enabled=a;b&&(b.showPoster=!a)};this.recordQOS=function(){for(var a in i)v(a)};this.destroy=function(){OT.DOMComponentCleanup.remove(this);o&&(o.destroy(),o=null);this.disconnect();n=null;a&&(a.destroy(),a=null);f&&(f.stop(),f=null);b&&(b.destroy(),b=null);this.session&&this._.unpublishFromSession(this.session);for(var e in s)clearInterval(s[e]),delete s[e];d=c=null;j=!1;_properties=h=null;this.trigger("destroyed",this);this.off();
return this};this.disconnect=function(){for(var a in i)this.cleanupSubscriber(a)};this.cleanupSubscriber=function(a){var b=i[a];clearInterval(s[a]);delete s[a];b&&(b.destroy(),delete i[a],p("disconnect","PeerConnection","subscriberConnection",a))};this.processMessage=function(a,b,c){OT.debug("OT.Publisher.processMessage: Received "+a+" from "+b.id);OT.debug(c);switch(a){case OT.WebSocketMessageType.JSEP_UNSUBSCRIBE:this.cleanupSubscriber(b.id);break;default:w.call(this,b).processMessage(a,c)}};this.getImgData=
function(){return!j?(OT.error("OT.Publisher.getImgData: Cannot getImgData before the Publisher is publishing."),null):a.imgData};this._={publishToSession:OT._.bind(function(a){this.session=a;var b=function(){this.session&&a.sendMessage(OT.WebSocketMessage.createStream(this.guid,k&&k.name?k.name:"",OT.VideoOrientation.ROTATED_NORMAL,640,480,k.publishAudio,k.publishVideo,this.session.sessionInfo.p2pEnabled))};if(j)b.call(this);else this.on("loaded",OT._.bind(b,this));p("publish","Attempt","streamType",
"WebRTC");return this},this),unpublishFromSession:OT._.bind(function(a){if(!this.session||a.id!==this.session.id)return OT.warn("The publisher "+this.guid+" is trying to unpublish from a session "+a.id+" it is not attached to"),this;a.connected&&this.stream&&a.sendMessage(OT.WebSocketMessage.destroyStream(this.stream.id));this.disconnect();this.session=null;p("unpublish","Success","sessionId",a.id);return this},this),publishedToSessionHandler:OT._.bind(function(){m=new Date},this)};this.detectDevices=
function(){OT.warn("Fixme: Haven't implemented detectDevices")};this.detectMicActivity=function(){OT.warn("Fixme: Haven't implemented detectMicActivity")};this.getEchoCancellationMode=function(){OT.warn("Fixme: Haven't implemented getEchoCancellationMode");return"fullDuplex"};this.setMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented setMicrophoneGain")};this.getMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented getMicrophoneGain");return 0.5};this.setCamera=function(){OT.warn("Fixme: Haven't implemented setCamera")};
this.setMicrophone=function(){OT.warn("Fixme: Haven't implemented setMicrophone")};this.on("styleValueChanged",OT._.bind(function(a,b){if(o)switch(a){case "nameDisplayMode":o.name.setDisplayMode(b)}},this));this.__defineGetter__("id",function(){return c});this.__defineGetter__("guid",function(){return e});this.__defineGetter__("stream",function(){return d});this.__defineSetter__("stream",function(a){d=a});this.__defineGetter__("streamId",function(){return!d?null:d.id});this.__defineGetter__("targetElement",
function(){return a.domElement});this.__defineGetter__("domId",function(){return c});this.__defineGetter__("session",function(){return h});this.__defineSetter__("session",function(a){h=a});this.__defineGetter__("isWebRTC",function(){return!0});Object.defineProperty(this._,"webRtcStream",{get:function(){return f}})}else OT.upgradeSystemRequirements()};OT.Publisher.nextId=uuid})(window);
(function(){OT.Subscriber=function(e,c){var b=uuid(),a=e||b,d,f={},h,i,j,k,m=c.session,n=!1,o,t,s,p=OT._.clone(c),v=new OT.Analytics,q=50;if(m){OT.$.eventing(this);OT.StylableComponent(this,{nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var u=function(a,c,d,e){v.logEvent({action:a,variation:c,payload_type:d,payload:e,stream_id:i?i.id:null,session_id:m?m.sessionId:null,connection_id:m&&m.connected?m.connection.connectionId:null,partner_id:m&&m.connected?m.sessionInfo.partnerId:
null,widget_id:b,widget_type:"Subscriber"})},y=function(){if(n&&m&&m.connected){var a={widget_type:"Subscriber",stream_type:"WebRTC",session_id:m?m.sessionId:null,connectionId:m?m.connection.connectionId:null,media_server_name:m?m.sessionInfo.messagingServer:null,partner_id:m?m.apiKey:null,stream_id:i.id,widget_id:b,version:OT.properties.version,duration:parseInt(OT.$.now()-o,10),remote_connection_id:i.connection.connectionId};k.getStats(function(b){if(b)for(stat_index in b)a[stat_index]=b[stat_index];
v.logQOS(a)})}},z=function(){n||0===f.length||(OT.debug("OT.Subscriber.onLoaded"),n=!0,o=OT.$.now(),u("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(o-t,10),k&&k.hasRelayCandidates].join("|")),s=setInterval(y,3E4),d.loading=!1,x.call(this),this.trigger("loaded",this),u("subscribe","Success","streamId",i.id))},g=function(){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");this.disconnect()},r=function(a,b){n||u("createPeerConnection","Failure",
"reason|hasRelayCandidates",["Subscriber PeerConnection Error: "+b,k&&k.hasRelayCandidates].join("|"));this.disconnect();u("subscribe","Failure","reason","Subscriber PeerConnection Error: "+b);OT.handleJsException("Subscriber PeerConnection Error: "+b,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:m,target:this});d&&d.addError(b)},A=function(a,b){OT.debug("OT.Subscriber.onRemoteStreamAdded");this.subscribeToAudio(p.subscribeToAudio);this.subscribeToVideo(p.subscribeToVideo);var c=new OT.VideoElement;
c.setAudioVolume(q);c.on({streamBound:OT._.bind(z,this),timeout:OT._.bind(r,this),error:OT._.bind(r,this)});"audio"===b&&OT.$.addClass(c.domElement,"OT_hidden-audio");c.bindToStream(a);d.video=c;OT.DOMComponentCleanup.add(this,c);f[b]=c;"audio"!==b&&this.streamOrientationDidChange(i.orientation.width,i.orientation.height,i.orientation.videoOrientation);u("createPeerConnection","StreamAdded","","");this.trigger("streamAdded",this)},B=function(a){OT.debug("OT.Subscriber.onStreamRemoved");for(var b in f)f[b].stream==
a&&(f[b].destroy(),delete f[b]);this.trigger("streamRemoved",this)},x=function(){h=(new OT.Chrome({parent:d.domElement})).set({name:new OT.Chrome.NamePanel({name:p.name,mode:this.getStyle("nameDisplayMode")}),opentokButton:new OT.Chrome.OpenTokButton}).on({muted:function(){},unmuted:function(){}})};this.recordQOS=function(){y()};this.subscribe=function(b){OT.debug("OT.Subscriber: subscribe to "+b.id);if(n)return OT.error("OT.Subscriber.Subscribe: Cannot subscribe, already subscribing."),!1;if(!b)return OT.error("OT.Subscriber: No stream parameter."),
!1;if(i)return OT.error("OT.Subscriber: Already subscribed"),!1;i=b;j=b.connection.connectionId;p.name=i.name;p.classNames="OT_root OT_subscriber";p.style&&this.setStyle(p.style,null,!0);p.audioVolume&&this.setAudioVolume(p.audioVolume);p.subscribeToAudio=OT.$.castToBoolean(p.subscribeToAudio,!0);p.subscribeToVideo=OT.$.castToBoolean(p.subscribeToVideo,!0);d=new OT.WidgetView(e,p);a=d.domId;t=OT.$.now();i.connection.id!==m.connection.id?(u("createPeerConnection","Attempt","",""),k=new OT.SubscriberPeerConnection(i.connection,
m,i,p),k.on({disconnected:OT._.bind(g,this),error:OT._.bind(r,this),remoteStreamAdded:OT._.bind(A,this),remoteStreamRemoved:OT._.bind(B,this)})):A.call(this,m.getPublisherForStream(i)._.webRtcStream,"merged");u("subscribe","Attempt","streamId",i.id);return this};this.destroy=function(){OT.DOMComponentCleanup.remove(this);this.disconnect();h&&(h.destroy(),h=null);d&&(d.destroy(),d=null);i&&u("unsubscribe",null,"streamId",i.id);i=a=null;clearInterval(s);p=m=null;this.trigger("destroyed",this);this.off();
return this};this.disconnect=function(){n=!1;for(var a in f)f[a].destroy();f={};k&&(k.destroy(),k=null,u("disconnect","PeerConnection","streamId",i.id))};this.processMessage=function(a,b,c){OT.debug("OT.Subscriber.processMessage: Received "+a+" message from "+b.id);OT.debug(c);j!=b.id&&(j=b.id);k&&k.processMessage(a,c)};this.processQualityChanged=function(a){this.dispatchEvent(new OT.ValueEvent("qualityChanged",a),OT._.bind(function(){this.subscribeToVideo(!1)},this))};this.getImgData=function(){return!this.subscribing?
(OT.error("OT.Subscriber.getImgData: Cannot getImgData before the Subscriber is subscribing."),null):(f.merged||f.video).imgData};this.setAudioVolume=function(a){a=parseInt(a,10);if(isNaN(a))return OT.error("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),this;q=Math.max(0,Math.min(100,a));q!=a&&OT.warn("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100");if(f.merged||f.audio)(f.merged||f.audio).setAudioVolume(q);return this};this.getAudioVolume=
function(){return f.merged||f.audio?(f.merged||f.audio).getAudioVolume():q};this.subscribeToAudio=function(a){a=OT.$.castToBoolean(a,!0);k&&(k.subscribeToAudio(a),m&&(i&&a!==p.subscribeToAudio)&&m.sendMessage(OT.WebSocketMessage.modifySubscriber(i.streamId,"hasAudio",a)));p.subscribeToAudio=a};this.subscribeToVideo=function(a){a=OT.$.castToBoolean(a,!0);k&&(k.subscribeToVideo(a),m&&(i&&a!==p.subscribeToVideo)&&m.sendMessage(OT.WebSocketMessage.modifySubscriber(i.streamId,"hasVideo",a)));p.subscribeToVideo=
a;d&&(d.showPoster=!(a&&i.hasVideo))};this.streamOrientationDidChange=function(a,b,c){(f.merged||f.video).orientation=c};this.streamHasVideoDidChange=function(a){d&&(d.showPoster=!(a&&p.subscribeToVideo))};this.streamHasAudioDidChange=function(){};this.on("styleValueChanged",OT._.bind(function(a,b){if(h)switch(a){case "nameDisplayMode":h.name.setDisplayMode(b)}},this));this.__defineGetter__("id",function(){return a});this.__defineGetter__("stream",function(){return i});this.__defineGetter__("targetElement",
function(){return f.merged||f.video?(f.merged||f.video).domElement:null});this.__defineGetter__("subscribing",function(){return n});this.__defineGetter__("isWebRTC",function(){return!0})}else OT.handleJsException("Subscriber must be passed a session option",2E3,{session:m,target:this})}})(window);
(function(){OT.SessionInfo=function(c){var b=null;this.sessionStatus=this.partnerId=this.sessionId=null;this.p2pEnabled=!1;this.iceServers=this.messagingServer=null;OT.log("SessionInfo Response:");OT.log(c);c&&(c.documentElement&&null!==c.documentElement.firstElementChild)&&(b=c.documentElement.firstElementChild);c=b.firstElementChild;do switch(c.localName){case "session_id":this.sessionId=c.textContent;break;case "partner_id":this.partnerId=c.textContent;break;case "session_status":this.sessionStatus=
c.textContent;break;case "messaging_server_url":this.messagingServer=c.textContent;break;case "ice_servers":this.iceServers=[];for(var b=c.childNodes,a,d,e=0,h=b.length;e<h;++e)"ice_server"===b[e].localName&&(d=b[e].attributes,a={url:d.getNamedItem("url").nodeValue},d.getNamedItem("credential")&&d.getNamedItem("credential").nodeValue.length&&(a.credential=d.getNamedItem("credential").nodeValue),this.iceServers.push(a));break;case "properties":if(b=c.firstElementChild){do if("p2p"===b.localName&&null!==
b.firstElementChild){this.p2pEnabled="enabled"===b.firstElementChild.textContent;break}while(b=b.nextElementSibling)}}while(c=c.nextElementSibling)};OT.SessionInfo.get=function(c,b,a){var d=OT.properties.apiURL+"/session/"+c.id+"?extended=true",e=OT.$.now();c.logEvent("getSessionInfo","Attempt","api_url",OT.properties.apiURL);OT.$.getXML(d,{headers:{"X-TB-TOKEN-AUTH":c.token,"X-TB-VERSION":1},success:function(d){c.logEvent("Instrumentation",null,"gsi",OT.$.now()-e);var i=parseErrorFromXMLDocument(d);
!1===i?onGetResponseCallback(c,b,d):onGetErrorCallback(c,a,i)},error:function(b){onGetErrorCallback(c,a,parseErrorFromXMLDocument(b.target.responseXML))}})};var e={};e["404"]=OT.ExceptionCodes.INVALID_SESSION_ID;e["403"]=OT.ExceptionCodes.AUTHENTICATION_ERROR;parseErrorFromXMLDocument=function(c){if(c&&c.documentElement&&null!==c.documentElement.firstElementChild){var c=c.evaluate("//error",c.documentElement,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),b=c.snapshotLength;if(0===b)return!1;for(;0<
b;)return c=c.snapshotItem(0),{code:c.getAttribute("code"),message:c.firstElementChild.getAttribute("message")}}return{code:null,message:"Unknown error: getSessionInfo XML response was badly formed"}};onGetResponseCallback=function(c,b,a){c.logEvent("getSessionInfo","Success","api_url",OT.properties.apiURL);b(new OT.SessionInfo(a))};onGetErrorCallback=function(c,b,a){TB.handleJsException("TB.SessionInfoError :: Unable to get session info "+a.message,e[a.code],{session:c});c.logEvent("getSessionInfo",
"Failure","errorMessage","TB.SessionInfoError :: Unable to get session info "+a.message);b(a,c)}})(window);(function(){OT.Capabilities=function(e){this.publish=OT._.contains(e,"publish")?1:0;this.subscribe=OT._.contains(e,"subscribe")?1:0;this.forceUnpublish=OT._.contains(e,"forceunpublish")?1:0;this.forceDisconnect=OT._.contains(e,"forcedisconnect")?1:0;this.supportsWebRTC=OT.$.supportsWebRTC()?1:0}})(window);
(function(){OT.Session=function(e){function c(a){for(var b in i){var c=i[b];if(a===c.streamId)return c}return null}function b(a){return!a.connection||!q.connections[a.connection.connectionId]?(OT.warn("Received a stream for a connection that doesn't exist"),OT.debug(a),!1):!0}function a(a){k[a.id]=a}if(OT.checkSystemRequirements()){var d=!1,f=!1,h,i={},j={},k={},m,n,o,t={},s=uuid(),p={},v=new OT.Analytics,q=new OT.SessionMessageWrangler(e);OT.$.eventing(this);var u=function(c){d=!0;f=!1;h=c.connectionId;
t=new OT.Capabilities(c.permissions);c.streams=OT._.filter(c.streams,function(a){return b(a)});c.streams.forEach(a);this.dispatchEvent(new OT.SessionConnectEvent(OT.Event.names.SESSION_CONNECTED,c.connections,c.streams,c.archives))},y=function(a){f=d=!1;OT.error(a.reason);this.trigger("sessionConnectFailed",a.reason);switch(a.code){case 409:TB.handleJsException("TB.SessionConnectionFailed :: The P2P session already has two participants.",OT.ExceptionCodes.CONNECT_REJECTED,{session:this});break;case 410:TB.handleJsException("TB.SessionConnectionFailed :: The session already has four participants.",
OT.ExceptionCodes.CONNECT_REJECTED,{session:this});break;default:TB.handleJsException("TB.SessionConnectionFailed :: The session failed to connect.",OT.ExceptionCodes.CONNECT_FAILED,{session:this})}},z=function(a,b){TB.handleJsException(a,b,{session:this})},g=function(a){var b=new OT.SessionDisconnectEvent("sessionDisconnected",a.reason);F.call(this);J.call(this);this.dispatchEvent(b,OT._.bind(function(){if(!b.isDefaultPrevented()){for(var a in i)G(i[a]);i={};p={};for(var c in j)j[c].destroy();j=
{}}},this))},r=function(a){a.connections=[a.connection];delete a.connection;this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_CREATED,a.connections))},A=function(a){h!==a.connection.connectionId&&delete q.connections[a.connection.connectionId];for(var b in i)i[b].cleanupSubscriber(a.connection.connectionId);a.connections=[a.connection];delete a.connection;this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_DESTROYED,a.connections,a.reason))},B=function(b){OT.debug(b.streams);
if(0!==b.streams.length){b.streams.forEach(a);var c;b.streams.forEach(function(a){a.publisherId?(c=i[a.publisherId],delete a.publisherId):c=this.getPublisherForStream(a.id);c&&(c.stream=a)})}},x=function(d){d.streams=OT._.filter(d.streams,b);OT.debug(d.streams);0<d.streams.length&&(d.streams.forEach(a),d.streams.forEach(function(a){(a=c(a.id))&&a._.publishedToSessionHandler()}),this.dispatchEvent(new OT.StreamEvent(OT.Event.names.STREAM_CREATED,d.streams,d.reason)))},w=function(a){OT.debug(a);var b=
{orientation:"videoDimensions",hasAudio:"hasAudio",hasVideo:"hasVideo"},c=a.key.split("/"),d=k[a.streamId],e=j[a.streamId],f=a.value,c=0<c.length?c[c.length-1]:null;if(!c||!b[c])OT.warn("Unknown stream property was modified.");else{var b=b[c],g=k[a.streamId],h=g[b];g.update(b,a.value);if("orientation"===c)e&&e.streamOrientationDidChange(a.value.width,a.value.height,a.value.videoOrientation),f={width:f.width,height:f.height};else if("hasVideo"===c||"hasAudio"===c)e&&("hasVideo"===c?e.streamHasVideoDidChange(a.value):
"hasAudio"===c&&e.streamHasAudioDidChange(a.value));this.dispatchEvent(new OT.StreamPropertyChangedEvent(OT.Event.names.STREAM_PROPERTY_CHANGED,d,b,h,f))}},E=function(a){if(!(0>=a.streams.length)){a.streams=OT._.filter(a.streams,function(a){return b(a)});var d=new OT.StreamEvent("streamDestroyed",a.streams,a.reason);this.dispatchEvent(d,OT._.bind(function(){var b=!d.isDefaultPrevented();a.streams.forEach(function(a){var d=c(a.id);d&&(d.disconnect(),b&&G(d),delete i[d.guid]);for(var e in j)e===a.id&&
(d=j[e],d.disconnect(),b&&this.unsubscribe(d),delete j[e]);delete k[a.id]},this)},this))}},D=function(a){OT.log("jsepMessageHandler: "+JSON.stringify(a));q.connections[a.fromAddress]||(OT.warn("OT.Session.onMessage: Received peerConnectionData from an unknown connection."),q.connections[a.fromAddress]=new OT.Connection(a.fromAddress,new Date,null,{supportsWebRTC:!0}));if(a.hasOwnProperty("streamId")){var b=null;(b=a.type==OT.WebSocketMessageType.JSEP_SUBSCRIBE||a.type==OT.WebSocketMessageType.JSEP_UNSUBSCRIBE?
c(a.streamId,!0):c(a.streamId,!0)||j[a.streamId])?b.processMessage(a.type,q.connections[a.fromAddress],a):OT.warn("OT.Session.onMessage: Received peerConnectionData for an unknown publisher.")}},H=function(a){var b=q.connections[a.fromAddress]||new OT.Connection(a.fromAddress,OT.$.now(),null,{}),c=a.messagePayload.data?JSON.parse(a.messagePayload.data):null,b=new OT.SignalEvent(a.messagePayload.type,c,b);b.target=this;this.trigger(OT.Event.names.SIGNAL,b);a.messagePayload.type&&this.dispatchEvent(b)},
I=function(a){j[a.streamId].processQualityChanged(a.quality)},F=function(){h=n=m=null;d=!1;t=null;q.connections={};k={}},J=function(){for(var a in i)i[a].disconnect();for(var b in j)j[b].disconnect()},G=function(a){p[a.guid]&&(a.off("destroyed",p[a.guid]),delete p[a.guid]);a.destroy()},C=function(a){p[a.guid]=OT._.bind(function(){this.unpublish(a)},this);a.on("destroyed",p[a.guid])},K=function(){TB.log("connectToMessenger");this.properties={requireConnectionObjects:!0};var a=function(a){return function(b){return function(){return b.apply(a,
arguments)}}}(this);o=(new OT.Messenger(this.sessionInfo.messagingServer,q)).on({SessionConnected:a(u),SessionConnectFailed:a(y),ConnectionClosed:a(g),ConnectionCreated:a(r),ConnectionDestroyed:a(A),StreamRegistered:a(B),StreamCreated:a(x),StreamModified:a(w),StreamDestroyed:a(E),JSEPMessageReceived:a(D),SignalReceived:a(H),SubscriberQualityChanged:a(I),exception:a(z)});o.connect(e,n,{requireConnectionObjects:this.properties.requireConnectionObjects,p2pEnabled:this.sessionInfo.p2pEnabled,widgetId:s,
partnerId:m})},L=function(){f&&OT.SessionInfo.get(this,OT._.bind(M,this),function(){f=!1})},M=function(a){f&&(this.sessionInfo=a,this.sessionInfo.partnerId&&this.sessionInfo.partnerId!=m?(m=this.sessionInfo.partnerId,TB.handleJsException("Authentication Error: The apiKey passed into the session.connect method does not match the apiKey in the token or session you are trying to connect to.",OT.ExceptionCodes.AUTHENTICATION_ERROR,{session:this})):K.call(this))};this.logEvent=function(a,b,c,d){v.logEvent({action:a,
variation:b,payload_type:c,payload:d,session_id:e,partner_id:m,widget_id:s,widget_type:"Controller"})};this.connect=function(a,b){d?OT.warn("OT.Session: Cannot connect, already connected."):f?OT.warn("OT.Session: Cannot connect, already connecting."):(f=!0,F.call(this),m=a.toString(),0===OT.APIKEY.length&&(OT.APIKEY=m),n=b,L.call(this))};this.disconnect=function(){f=!1;o&&(o.disconnect(),o=null)};this.publish=function(a,b){var c;if(!d)throw v.logError(1010,"tb.exception","We need to be connected before you can publish",
null,{action:"publish",variation:"Failure",payload_type:"reason",payload:"We need to be connected before you can publish",session_id:e,partner_id:m,widgetId:s,widget_type:"Controller"}),c="We need to be connected before you can publish",OT.error(c),Error(c);if(1!==t.publish)return v.logEvent({action:"publish",variation:"Failure",payload_type:"reason",payload:"This token does not allow publishing. The role must be at least `publisher` to enable this functionality",session_id:e,partner_id:m,widgetId:s,
widget_type:"Controller"}),TB.handleJsException("This token does not allow publishing. The role must be at least `publisher` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_PUBLISH,{session:this}),null;if(!a||"string"===typeof a)a=OT.initPublisher(this.apiKey,a,b);else if(a instanceof OT.Publisher)"session"in a&&(a.session&&"sessionId"in a.session)&&(a.session.sessionId===this.sessionId?OT.warn("Cannot publish "+a.guid+" again to "+this.sessionId+". Please call session.unpublish(publisher) first."):
OT.warn("Cannot publish "+a.guid+" publisher already attached to "+a.session.sessionId+". Please call session.unpublish(publisher) first."));else throw c="Session.publish :: First parameter passed in is neither a string nor an instance of the Publisher",OT.error(c),Error(c);i[a.guid]=a;a._.publishToSession(this);C.call(this,a);return a};this.unpublish=function(a){a?a._.unpublishFromSession(this):OT.error("OT.Session.unpublish: publisher parameter missing.")};this.modifyStream=function(a,b,c){(!a||
!b||!c)&&OT.error("OT.Session.modifyStream: must provide streamId, key and value to modify a stream property.");o.sendMessage(OT.WebSocketMessage.modifyStream(a,b,c))};this.subscribe=function(a,b,c){if(!this.connection||!this.connection.connectionId)throw a="Session.subscribe :: Connection required to subscribe",OT.error(a),Error(a);if(!a)throw a="Session.subscribe :: stream cannot be null",OT.error(a),Error(a);if(!a.hasOwnProperty("streamId"))throw a="Session.subscribe :: invalid stream object",
OT.error(a),Error(a);b=new OT.Subscriber(b,OT._.extend(c||{},{session:this}));j[a.streamId]=b;b.subscribe(a);return b};this.unsubscribe=function(a){if(!a)throw OT.error("OT.Session.unsubscribe: subscriber cannot be null"),Error("OT.Session.unsubscribe: subscriber cannot be null");if(!a.stream)return OT.warn("OT.Session.unsubscribe:: tried to unsubscribe a subscriber that had no stream"),!1;OT.debug("OT.Session.unsubscribe: subscriber "+a.id);delete j[a.stream.id];a.destroy();return!0};this.getSubscribersForStream=
function(a){return[j[a.id]]};this.getPublisherForStream=function(a){if("string"!=typeof a)if("object"==typeof a&&a&&a.hasOwnProperty("id"))a=a.id;else throw errorMsg="Session.getPublisherForStream :: Invalid stream type",OT.error(errorMsg),Error(errorMsg);return c(a)};this.sendMessage=function(){return o.sendMessage.apply(o,arguments)};this.signal=function(a){o.signal(a)};this.sendJSEPMessage=function(a,b,c){o&&o.connectionId?o.sendMessage(OT.WebSocketMessage.jsepMessage(o.connectionId,a.connectionId,
b,c)):OT.warn("Session.sendJSEPMessage :: Tried to send a message without a _messenger")};this.forceDisconnect=function(a){1===t.forceDisconnect?o.sendMessage(OT.WebSocketMessage.forceDisconnect("string"===typeof a?a:a.id)):TB.handleJsException("This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,{session:this})};this.forceUnpublish=function(a){1===t.forceUnpublish?o.sendMessage(OT.WebSocketMessage.forceUnpublish("string"===
typeof a?a:a.id)):TB.handleJsException("This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,{session:this})};this.getStateManager=function(){OT.warn("Fixme: Have not implemented session.getStateManager")};this.__defineGetter__("apiKey",function(){return m});this.__defineGetter__("token",function(){return n});this.__defineGetter__("connected",function(){return d});this.__defineGetter__("connection",
function(){return q.connections[h]});this.__defineSetter__("connection",function(a){a.hasOwnProperty("connectionId")&&(h=a.connectionId,q.connections[h]=a)});this.__defineGetter__("capabilities",function(){return t});this.__defineGetter__("sessionId",function(){return e});this.__defineGetter__("id",function(){return e});this.__defineGetter__("connections",function(){return q.connections});this.__defineGetter__("publishers",function(){return i})}else OT.upgradeSystemRequirements()}})(window);
(function(){OT.SessionMessageWrangler=function(){var e={};this.__defineGetter__("connections",function(){return e});var c=function(a){a=new OT.Connection(a.connectionId,a.creationTime,a.data,{supportsWebRTC:a.supportsWebRTC});return e[a.connectionId]=a},b=function(a){return Object.keys(a).map(function(b){return c(a[b])})},a=function(a,b){var c=[],i;for(i in a)if(a.hasOwnProperty(i)){var j;j=a[i];var k=OT.Stream,m=j.streamId,n=void 0;a:if(e[j.connection.connectionId])n=e[j.connection.connectionId];
else{if(b)for(var n=0,o=b.length;n<o;++n)if(j.connection.connectionId===b[n].id){n=b[n];break a}n=null}k=new k(m,n,j.name,j.streamData,j.type,j.creationTime,j.hasAudio,j.hasVideo,j.orientation?j.orientation:{videoOrientation:OT.VideoOrientation.ROTATED_NORMAL,width:640,height:480},j.peerId,j.quality,j.orientation?j.orientation.width:640,j.orientation?j.orientation.height:480);j.publisherId&&(k.publisherId=j.publisherId);(j=k)&&c.push(j)}return c};this.wrangle=function(d){if(d.sessionState){if(d.sessionState.CONNECTIONS&&
(d.connections=b(d.sessionState.CONNECTIONS)),d.sessionState.STREAMS)d.streams=a(d.sessionState.STREAMS,d.connections)}else if(d.streams&&(d.streams=a(d.streams,d.connections)),d.connection)d.connection=c(d.connection);return d}}})(window);(function(){var e=document.createElement("link");e.type="text/css";e.media="screen";e.rel="stylesheet";e.href=OT.properties.cssURL;(document.head||document.getElementsByTagName("head")[0]).appendChild(e)})(window);